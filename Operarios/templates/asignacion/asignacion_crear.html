{% extends "base.html" %}
{% load static %}
{% block base_head %}
<link href="{% static 'style/overrride.css' %}" type="text/css" media="all" rel="stylesheet">
</link>
{% endblock %}
{% block content %}

<div class="container-fluid">

    {% if title %}<h1 class='my-3'>{{ title }}</h1>{% endif %}
    <form method='POST' action='#' name='formulario' id='formulario'>
        <input type="hidden" id="action" name="action" value="">
        {% csrf_token %}

        <div class="col-lg-12 col-md-12">
            <div class="row mt-3">
                <div class="col h4"><u><strong> Punto de Servicio:</strong></u>
                    ({{ pservicio.CodPuntoServicio }}) - {{ pservicio.NombrePServicio }}
                    <!-- {{ form.puntoServicio.as_hidden }} -->
                </div>
            </div>
            <label for="id_puntoServicio">
            </label>
            <input type="text" name="puntoServicio" class="form-control form-control-sm d-none" value="{{pservicio.id}}"
                id="id_puntoServicio">
            <div class="row mt-3">
                <div class="col-3">
                    <p class="font-weight-bold"> Totales </p>
                </div>
                <div class="col-4">
                    <p class="font-weight-bold text-center"> Semanales (Lunes a Sabado)</p>
                </div>
                <div class="col-4">
                    <p class="font-weight-bold text-center"> Domingo </p>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-2"> Total Hrs: </div>
                <div class="col-1"> <input id="sumAll_total" type="text" value="{{ relevamiento.cantidadHrTotal }}"
                        class="form-control form-control-sm" readonly /> </div>
                <div class="col-1"> Diurnas: </div>
                <div class="col-1"> <input id="tot_sem_diu" type="text" value="{{ sem_diurno }}"
                        class="form-control form-control-sm" readonly /> </div>
                <div class="col-1"> Nocturnas: </div>
                <div class="col-1"> <input id="tot_sem_noc" type="text" value="{{ sem_nocturno }}"
                        class="form-control form-control-sm" readonly /> </div>
                <div class="col-1"> Diurnas: </div>
                <div class="col-1"> <input id="tot_dom_diu" type="text" value="{{ dom_diurno }}"
                        class="form-control form-control-sm" readonly /> </div>
                <div class="col-1"> Nocturnas: </div>
                <div class="col-1"> <input id="tot_dom_noc" type="text" value="{{ dom_nocturno }}"
                        class="form-control form-control-sm" readonly /> </div>
            </div>
            <div class="row mt-3">
                <div class="col-2"> Total Hrs Asignadas: </div>
                <div class="col-1"> <input type="text" name="totalasignado" class="form-control form-control-sm"
                        value="" maxlength="8" required="" id="id_totalasignado"></div>
                <div class="col-1"> Asignada: </div>
                <div class="col-1"> <input id="sum_sem_diu" type="text" value="" class="form-control form-control-sm"
                        readonly /> </div>
                <div class="col-1"> Asignada: </div>
                <div class="col-1"> <input id="sum_sem_noc" type="text" value="" class="form-control form-control-sm"
                        readonly /> </div>
                <div class="col-1"> Asignada: </div>
                <div class="col-1"> <input id="sum_dom_diu" type="text" value="" class="form-control form-control-sm"
                        readonly /> </div>
                <div class="col-1"> Asignada: </div>
                <div class="col-1"> <input id="sum_dom_noc" type="text" value="" class="form-control form-control-sm"
                        readonly /> </div>
            </div>
            <hr />
            <div class="row mt-3">
                <div class="col-2"> Total Hrs Restante: </div>
                <div class="col-1"> <input id="sumAll_resto" type="text" value="" class="form-control form-control-sm"
                        readonly /> </div>
                <div class="col-1"> Restantes: </div>
                <div class="col-1"> <input id="res_sem_diu" type="text" value="" class="form-control form-control-sm"
                        readonly /> </div>
                <div class="col-1"> Restantes: </div>
                <div class="col-1"> <input id="res_sem_noc" type="text" value="" class="form-control form-control-sm"
                        readonly /> </div>
                <div class="col-1"> Restantes: </div>
                <div class="col-1"> <input id="res_dom_diu" type="text" value="" class="form-control form-control-sm"
                        readonly /> </div>
                <div class="col-1"> Restantes: </div>
                <div class="col-1"> <input id="res_dom_noc" type="text" value="" class="form-control form-control-sm"
                        readonly /> </div>
            </div>
        </div>
        <div class="container-main col-lg-12 col-md-12">

            <div class="row">
                <div class="col-lg-12 col-md-12">
                    <h4>
                        Asignación de Horas
                    </h4>
                </div>

            </div>

            <div class="row container-main">
                <div class="col-lg-12 col-md-12" style="text-align: right;margin-bottom: 15px;">
                    <button type='button' id='addDetalle' class="btn btn-primary btn-guardar" onclick="goToAddDetalle()"
                        name='add_det'>
                        <i class="fa fa-plus"></i> &nbsp;&nbsp;Agregar Detalle</button>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="card" style="margin-bottom:15px !important;">
                        <div class="card-header">
                            <div class="row">
                                <div class="col-md-12">
                                    Detalles
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <table class="table table-bordered">
                                <thead class="header-table">
                                    <tr>
                                        <th>Perfil</th>
                                        <th>Operario</th>
                                        <th>Lun</th>
                                        <th>Mar</th>
                                        <th>Mier</th>
                                        <th>Jue</th>
                                        <th>Vie</th>
                                        <th>Sab</th>
                                        <th>Dom</th>
                                        <th>Acción</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for asig in asignaciones %}
                                        <tr id="{{asig.id}}" class="row-table">
                                            <td>{{asig.perfil_nombre}}</td>
                                            <td style="width: 40%;">
                                                {% if asig.supervisor %}
                                                    <i class="fas fa-user-tie" style="margin:0px 10px !important;color:#86273e;"></i> 
                                                {% else %}
                                                    <i class="fas fa-user" style="margin:0px 10px !important;color:gray;"></i> 
                                                {% endif %}
                                                {{asig.operario_nombre}} (<span id="cantTotal-{{forloop.counter}}"></span>)</td>
                                            <td class="d-none td-total"><input type="hidden" class="totalHoras-asignaciones"
                                                    id="totalhoras-{{ forloop.counter }}" value="{{asig.totalHoras}}"></td>
                                            <!-- CONTROL DE EXISTENCIA DE HORAS -->
                                            <td class="lunes">{% if asig.lunEnt and asig.lunSal %} {{asig.lunEnt}} a
                                                {{asig.lunSal}} {% endif %}</td>
                                            <td class="martes">{% if asig.marEnt and asig.marSal %} {{asig.marEnt}} a
                                                {{asig.marSal}} {% endif %}</td>
                                            <td class="miercoles"> {% if asig.mieEnt and asig.mieSal %} {{asig.mieEnt}} a
                                                {{asig.mieSal}} {% endif %}</td>
                                            <td class="jueves">{% if asig.jueEnt and asig.jueSal %} {{asig.jueEnt}} a
                                                {{asig.jueSal}}{% endif %}</td>
                                            <td class="viernes"> {% if asig.vieEnt and asig.vieSal %} {{asig.vieEnt}} a
                                                {{asig.vieSal}} {% endif %}</td>
                                            <td class="sabado"> {% if asig.sabEnt and asig.sabSal %} {{asig.sabEnt}} a
                                                {{asig.sabSal}} {% endif %} </td>
                                            <td class="domingo"> {% if asig.domEnt and asig.domSal %} {{asig.domEnt}} a
                                                {{asig.domSal}} {% endif %} </td>
                                            <td class="d-none"><input type="hidden" id="{{asig.id}}-eliminar"
                                                value="{{asig.tipo}}">
                                            </td>
                                            <td>
                                                <a onclick="verRegistro({{asig.id}})" class="action-table" title="Ver"><i
                                                        class="fas fa-eye"></i> </a>
                                                <a class="action-table" title="Eliminar"
                                                    onclick="eliminarRegistro({{asig.id}})"><i class="fas fa-trash"></i>
                                                </a>
                                            </td>

                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class="col-lg-12 col-md-12" style="text-align: right;margin:15px 0px;">
            <button type='button' id="guardar" onclick="guardarAsignacion()" class='btn btn-primary btn-guardar'> <i
                    class="fa fa-check"></i>&nbsp;&nbsp; Confirmar</button>
            <a class='btn btn-primary btn-cancelar' href={% url 'Operarios:asignacion_list' %}> <i
                    class="fa fa-times"></i> &nbsp;&nbsp; Cancelar</a>
        </div>

        <!--VERSION ANTERIOR DE ASIGNACION, CONJUNTO DE FORMULARIOS-->
        <!-- 
        {{ asigDetFormSet.management_form }}
        <div class="container-main col-lg-12 col-md-12" id='formset-det'>

            <div class="row">
                <div class="col-lg-12 col-md-12">
                    <h4>
                        Asignación de Horas <small class="text-muted">Definicion de operarios y horas</small>
                    </h4>
                </div>

            </div>

            <div class="row container-main">
                <div class="col-lg-12 col-md-12" style="text-align: right;margin-bottom: 15px;">
                    <button type='button' id='btnDet' class="btn btn-info" name='add_det'>
                        <i class="fa fa-plus"></i>Agregar Detalle</button>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4 p-0 mt-3" style="text-align: center;"> Operario </div>
                <div class="col p-0 text-center"> Horas Requeridas </div>
                <div class="col p-0 text-center"> Lunes </div>
                <div class="col p-0 text-center"> Martes </div>
                <div class="col p-0 text-center"> Miercoles </div>
                <div class="col p-0 text-center"> Jueves </div>
                <div class="col p-0 text-center"> Viernes </div>
                <div class="col p-0 text-center"> Sabado </div>
                <div class="col p-0 text-center"> Domingo </div>
                <div class="col-1 p-0 text-center"> Eliminar? </div>
            </div>

            {% for form in asigDetFormSet %}



            <div class="row mt-2 leaveForm" id="leaveForm-{{ forloop.counter0 }}" style="    margin-bottom: 30px;">
                <div class="row">
                    <div class="col-md-4">
                        <div class="row" style="margin: 0px 0px 10px 0px;">
                            <div class="col-md-4 text-center p-0">
                                <button type="button" class="btn btn-info btn-block btn-filter_operario"
                                    id="filter_operario-{{forloop.counter0}}" name='filter_operario' style="    height: 39px;
                                                border-top-right-radius: 0px;
                                                border-bottom-right-radius: 0px;" disabled><i
                                        class="fa fa-search"></i></button>
                            </div>

                            {{form.id}}
                            <input type="hidden" id="openModal" value="{{openModal}}">
                            <input type="hidden" id="idModal" value="{{idModal}}">
                            <div class="col-md-8 p-0">
                                {{form.operario}}
                                <select name="operario-{{forloop.counter0}}" class="form-control form-control-sm "
                                    readonly="readonly" style="height:39px !important" disabled="disabled"
                                    id="operario-{{forloop.counter0}}">
                                    <option value=""></option>
                                    {% for ope in allOperarios %}
                                    <option value="{{ope.id}}">{{ope.nombre}} {{ope.apellido}} - {{ope.nroLegajo}}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">

                                <div class="input-group date">
                                    {{form.fechaInicio}}
                              
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group date">
                                   
                                    {{form.fechaFin}}
                                </div>
                            </div>
                        </div>
                        <div class="row" style="margin-top: 20px;">
                            <div class="col-md-6">
                                <p>
                                    <label for="">Perfil</label>
                                    <select class="form-control form-control-sm select-form"
                                        id="perfil-{{ forloop.counter0}}" style="display:none;">
                                        <option value="">---------</option>
                                        {% for perfil in perfiles %}
                                        <option value="{{perfil.id}}">{{perfil.especializacion}}</option>
                                        {% endfor %}

                                    </select>
                                    {{form.perfil}}
                                </p>


                            </div>
                            <div class="col-md-6" style="display:flex;align-items:center !important;">
                                <div class="input-group date" style="display:flex;justify-content :center !important;">
                                    <p style="display:inline-flex !important;margin:0px !important;">
                                        <label for="">Supervisor</label>
                                        <input type="checkbox" class="checkbox-supervisor" style="display:none"
                                            id="supervisor-{{ forloop.counter0}}">
                                        {{form.supervisor}}
                                    </p>

                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="col-md-8">
                        <div class="row input-horas">
                            <div class="col pl-0">
                                <div class="input-group date" style="    margin: 0px 0px 10px 0px;
                                            height: 39px;">
                                    <input type="text" value="{{form.totalHoras.value |default_if_none:''}}"
                                        name="asignaciondet_set-{{ forloop.counter0 }}-totalHoras"
                                        class="form-control form-control-sm" readonly="readonly" maxlength="8"
                                        id="id_asignaciondet_set-{{ forloop.counter0 }}-totalHoras">
                                    <script>
                                        $(document).ready(function () {
                                        $('input[name=asignaciondet_set-{{ forloop.counter0 }}-totalHoras]').ready(
                                            function(){
                                                console.log("cambio valor");
                                                RecalcularHorasV2();
                                                RecalcularTipoHoras();

                                        });
                                        });
                                    </script>
                                </div>

                            </div>
                            <div class="col pl-0">
                                <div class="input-group date" style="margin:0px 0px 16px 0px;">
                                    <input type="text" value="{{form.lunEnt.value}}"
                                        name="asignaciondet_set-{{ forloop.counter0 }}-lunEnt"
                                        class="form-control form-control-sm"
                                        id="id_asignaciondet_set-{{ forloop.counter0 }}-lunEnt"
                                        dp_config="{&quot;id&quot;: &quot;dp_20&quot;, &quot;picker_type&quot;: &quot;TIME&quot;, &quot;linked_to&quot;: null, &quot;options&quot;: {&quot;showClose&quot;: true, &quot;showClear&quot;: true, &quot;showTodayButton&quot;: false, &quot;useCurrent&quot;: false, &quot;stepping&quot;: 5, &quot;format&quot;: &quot;HH:mm&quot;}}">
                                    <div class="input-group-addon input-group-append" data-target="#datetimepicker1"
                                        data-toggle="datetimepickerv">
                                        <div class="input-group-text"><i class="glyphicon glyphicon-time"></i></div>
                                    </div>
                                </div>
                                <div class="input-group date">
                                    <input type="text" value="{{form.lunSal.value}}"
                                        name="asignaciondet_set-{{ forloop.counter0 }}-lunSal"
                                        class="form-control form-control-sm"
                                        id="id_asignaciondet_set-{{ forloop.counter0 }}-lunSal"
                                        dp_config="{&quot;id&quot;: &quot;dp_21&quot;, &quot;picker_type&quot;: &quot;TIME&quot;, &quot;linked_to&quot;: &quot;dp_20&quot;, &quot;options&quot;: {&quot;showClose&quot;: true, &quot;showClear&quot;: true, &quot;showTodayButton&quot;: false, &quot;useCurrent&quot;: false, &quot;stepping&quot;: 5, &quot;format&quot;: &quot;HH:mm&quot;}}">
                                    <div class="input-group-addon input-group-append" data-target="#datetimepicker1"
                                        data-toggle="datetimepickerv">
                                        <div class="input-group-text"><i class="glyphicon glyphicon-time"></i></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col pl-0">
                                <div class="input-group date" style="margin:0px 0px 16px 0px;">
                                    <input type="text" value="{{form.marEnt.value}}"
                                        name="asignaciondet_set-{{ forloop.counter0 }}-marEnt"
                                        class="form-control form-control-sm"
                                        id="id_asignaciondet_set-{{ forloop.counter0 }}-marEnt"
                                        dp_config="{&quot;id&quot;: &quot;dp_22&quot;, &quot;picker_type&quot;: &quot;TIME&quot;, &quot;linked_to&quot;: null, &quot;options&quot;: {&quot;showClose&quot;: true, &quot;showClear&quot;: true, &quot;showTodayButton&quot;: false, &quot;useCurrent&quot;: false, &quot;stepping&quot;: 5, &quot;format&quot;: &quot;HH:mm&quot;}}">
                                    <div class="input-group-addon input-group-append" data-target="#datetimepicker1"
                                        data-toggle="datetimepickerv">
                                        <div class="input-group-text"><i class="glyphicon glyphicon-time"></i></div>
                                    </div>
                                </div>
                                <div class="input-group date">
                                    <input type="text" value="{{form.marSal.value}}"
                                        name="asignaciondet_set-{{ forloop.counter0 }}-marSal"
                                        class="form-control form-control-sm"
                                        id="id_asignaciondet_set-{{ forloop.counter0 }}-marSal"
                                        dp_config="{&quot;id&quot;: &quot;dp_23&quot;, &quot;picker_type&quot;: &quot;TIME&quot;, &quot;linked_to&quot;: &quot;dp_22&quot;, &quot;options&quot;: {&quot;showClose&quot;: true, &quot;showClear&quot;: true, &quot;showTodayButton&quot;: false, &quot;useCurrent&quot;: false, &quot;stepping&quot;: 5, &quot;format&quot;: &quot;HH:mm&quot;}}">
                                    <div class="input-group-addon input-group-append" data-target="#datetimepicker1"
                                        data-toggle="datetimepickerv">
                                        <div class="input-group-text"><i class="glyphicon glyphicon-time"></i></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col pl-0">
                                <div class="input-group date" style="margin:0px 0px 16px 0px;">
                                    <input type="text" value="{{form.mieEnt.value}}"
                                        name="asignaciondet_set-{{ forloop.counter0 }}-mieEnt"
                                        class="form-control form-control-sm"
                                        id="id_asignaciondet_set-{{ forloop.counter0 }}-mieEnt"
                                        dp_config="{&quot;id&quot;: &quot;dp_24&quot;, &quot;picker_type&quot;: &quot;TIME&quot;, &quot;linked_to&quot;: null, &quot;options&quot;: {&quot;showClose&quot;: true, &quot;showClear&quot;: true, &quot;showTodayButton&quot;: false, &quot;useCurrent&quot;: false, &quot;stepping&quot;: 5, &quot;format&quot;: &quot;HH:mm&quot;}}">
                                    <div class="input-group-addon input-group-append" data-target="#datetimepicker1"
                                        data-toggle="datetimepickerv">
                                        <div class="input-group-text"><i class="glyphicon glyphicon-time"></i></div>
                                    </div>
                                </div>
                                <div class="input-group date">
                                    <input type="text" value="{{form.mieSal.value}}"
                                        name="asignaciondet_set-{{ forloop.counter0 }}-mieSal"
                                        class="form-control form-control-sm"
                                        id="id_asignaciondet_set-{{ forloop.counter0 }}-mieSal"
                                        dp_config="{&quot;id&quot;: &quot;dp_25&quot;, &quot;picker_type&quot;: &quot;TIME&quot;, &quot;linked_to&quot;: &quot;dp_24&quot;, &quot;options&quot;: {&quot;showClose&quot;: true, &quot;showClear&quot;: true, &quot;showTodayButton&quot;: false, &quot;useCurrent&quot;: false, &quot;stepping&quot;: 5, &quot;format&quot;: &quot;HH:mm&quot;}}">
                                    <div class="input-group-addon input-group-append" data-target="#datetimepicker1"
                                        data-toggle="datetimepickerv">
                                        <div class="input-group-text"><i class="glyphicon glyphicon-time"></i></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col pl-0">
                                <div class="input-group date" style="margin:0px 0px 16px 0px;">
                                    <input type="text" value="{{form.jueEnt.value}}"
                                        name="asignaciondet_set-{{ forloop.counter0 }}-jueEnt"
                                        class="form-control form-control-sm"
                                        id="id_asignaciondet_set-{{ forloop.counter0 }}-jueEnt"
                                        dp_config="{&quot;id&quot;: &quot;dp_26&quot;, &quot;picker_type&quot;: &quot;TIME&quot;, &quot;linked_to&quot;: null, &quot;options&quot;: {&quot;showClose&quot;: true, &quot;showClear&quot;: true, &quot;showTodayButton&quot;: false, &quot;useCurrent&quot;: false, &quot;stepping&quot;: 5, &quot;format&quot;: &quot;HH:mm&quot;}}">
                                    <div class="input-group-addon input-group-append" data-target="#datetimepicker1"
                                        data-toggle="datetimepickerv">
                                        <div class="input-group-text"><i class="glyphicon glyphicon-time"></i></div>
                                    </div>
                                </div>
                                <div class="input-group date">
                                    <input type="text" value="{{form.jueSal.value}}"
                                        name="asignaciondet_set-{{ forloop.counter0 }}-jueSal"
                                        class="form-control form-control-sm"
                                        id="id_asignaciondet_set-{{ forloop.counter0 }}-jueSal"
                                        dp_config="{&quot;id&quot;: &quot;dp_27&quot;, &quot;picker_type&quot;: &quot;TIME&quot;, &quot;linked_to&quot;: &quot;dp_26&quot;, &quot;options&quot;: {&quot;showClose&quot;: true, &quot;showClear&quot;: true, &quot;showTodayButton&quot;: false, &quot;useCurrent&quot;: false, &quot;stepping&quot;: 5, &quot;format&quot;: &quot;HH:mm&quot;}}">
                                    <div class="input-group-addon input-group-append" data-target="#datetimepicker1"
                                        data-toggle="datetimepickerv">
                                        <div class="input-group-text"><i class="glyphicon glyphicon-time"></i></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col pl-0">
                                <div class="input-group date" style="margin:0px 0px 16px 0px;">
                                    <input type="text" value="{{form.vieEnt.value}}"
                                        name="asignaciondet_set-{{ forloop.counter0 }}-vieEnt"
                                        class="form-control form-control-sm"
                                        id="id_asignaciondet_set-{{ forloop.counter0 }}-vieEnt"
                                        dp_config="{&quot;id&quot;: &quot;dp_28&quot;, &quot;picker_type&quot;: &quot;TIME&quot;, &quot;linked_to&quot;: null, &quot;options&quot;: {&quot;showClose&quot;: true, &quot;showClear&quot;: true, &quot;showTodayButton&quot;: false, &quot;useCurrent&quot;: false, &quot;stepping&quot;: 5, &quot;format&quot;: &quot;HH:mm&quot;}}">
                                    <div class="input-group-addon input-group-append" data-target="#datetimepicker1"
                                        data-toggle="datetimepickerv">
                                        <div class="input-group-text"><i class="glyphicon glyphicon-time"></i></div>
                                    </div>
                                </div>
                                <div class="input-group date">
                                    <input type="text" value="{{form.vieSal.value}}"
                                        name="asignaciondet_set-{{ forloop.counter0 }}-vieSal"
                                        class="form-control form-control-sm"
                                        id="id_asignaciondet_set-{{ forloop.counter0 }}-vieSal"
                                        dp_config="{&quot;id&quot;: &quot;dp_29&quot;, &quot;picker_type&quot;: &quot;TIME&quot;, &quot;linked_to&quot;: &quot;dp_28&quot;, &quot;options&quot;: {&quot;showClose&quot;: true, &quot;showClear&quot;: true, &quot;showTodayButton&quot;: false, &quot;useCurrent&quot;: false, &quot;stepping&quot;: 5, &quot;format&quot;: &quot;HH:mm&quot;}}">
                                    <div class="input-group-addon input-group-append" data-target="#datetimepicker1"
                                        data-toggle="datetimepickerv">
                                        <div class="input-group-text"><i class="glyphicon glyphicon-time"></i></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col pl-0">
                                <div class="input-group date" style="margin:0px 0px 16px 0px;">
                                    <input type="text" value="{{form.sabEnt.value}}"
                                        name="asignaciondet_set-{{ forloop.counter0 }}-sabEnt"
                                        class="form-control form-control-sm"
                                        id="id_asignaciondet_set-{{ forloop.counter0 }}-sabEnt"
                                        dp_config="{&quot;id&quot;: &quot;dp_30&quot;, &quot;picker_type&quot;: &quot;TIME&quot;, &quot;linked_to&quot;: null, &quot;options&quot;: {&quot;showClose&quot;: true, &quot;showClear&quot;: true, &quot;showTodayButton&quot;: false, &quot;useCurrent&quot;: false, &quot;stepping&quot;: 5, &quot;format&quot;: &quot;HH:mm&quot;}}">
                                    <div class="input-group-addon input-group-append" data-target="#datetimepicker1"
                                        data-toggle="datetimepickerv">
                                        <div class="input-group-text"><i class="glyphicon glyphicon-time"></i></div>
                                    </div>
                                </div>
                                <div class="input-group date">
                                    <input type="text" value="{{form.sabSal.value}}"
                                        name="asignaciondet_set-{{ forloop.counter0 }}-sabSal"
                                        class="form-control form-control-sm"
                                        id="id_asignaciondet_set-{{ forloop.counter0 }}-sabSal"
                                        dp_config="{&quot;id&quot;: &quot;dp_31&quot;, &quot;picker_type&quot;: &quot;TIME&quot;, &quot;linked_to&quot;: &quot;dp_30&quot;, &quot;options&quot;: {&quot;showClose&quot;: true, &quot;showClear&quot;: true, &quot;showTodayButton&quot;: false, &quot;useCurrent&quot;: false, &quot;stepping&quot;: 5, &quot;format&quot;: &quot;HH:mm&quot;}}">
                                    <div class="input-group-addon input-group-append" data-target="#datetimepicker1"
                                        data-toggle="datetimepickerv">
                                        <div class="input-group-text"><i class="glyphicon glyphicon-time"></i></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col pl-0">
                                <div class="input-group date" style="margin:0px 0px 16px 0px;">
                                    <input type="text" value="{{form.domEnt.value}}"
                                        name="asignaciondet_set-{{ forloop.counter0 }}-domEnt"
                                        class="form-control form-control-sm"
                                        id="id_asignaciondet_set-{{ forloop.counter0 }}-domEnt"
                                        dp_config="{&quot;id&quot;: &quot;dp_32&quot;, &quot;picker_type&quot;: &quot;TIME&quot;, &quot;linked_to&quot;: null, &quot;options&quot;: {&quot;showClose&quot;: true, &quot;showClear&quot;: true, &quot;showTodayButton&quot;: false, &quot;useCurrent&quot;: false, &quot;stepping&quot;: 5, &quot;format&quot;: &quot;HH:mm&quot;}}">
                                    <div class="input-group-addon input-group-append" data-target="#datetimepicker1"
                                        data-toggle="datetimepickerv">
                                        <div class="input-group-text"><i class="glyphicon glyphicon-time"></i></div>
                                    </div>
                                </div>
                                <div class="input-group date">
                                    <input type="text" value="{{form.domSal.value}}"
                                        name="asignaciondet_set-{{ forloop.counter0 }}-domSal"
                                        class="form-control form-control-sm"
                                        id="id_asignaciondet_set-{{ forloop.counter0 }}-domSal"
                                        dp_config="{&quot;id&quot;: &quot;dp_33&quot;, &quot;picker_type&quot;: &quot;TIME&quot;, &quot;linked_to&quot;: &quot;dp_32&quot;, &quot;options&quot;: {&quot;showClose&quot;: true, &quot;showClear&quot;: true, &quot;showTodayButton&quot;: false, &quot;useCurrent&quot;: false, &quot;stepping&quot;: 5, &quot;format&quot;: &quot;HH:mm&quot;}}">
                                    <div class="input-group-addon input-group-append" data-target="#datetimepicker1"
                                        data-toggle="datetimepickerv">
                                        <div class="input-group-text"><i class="glyphicon glyphicon-time"></i></div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-1 pl-0" style="display: flex;
                                        justify-content: center;
                                        align-items: center;
                                        color: red !important;
                                        font-size: 25px;">
                                {{form.DELETE}}

                                <a href="javascript:void(0);" onclick="deleteLeaveRow(this, {{ forloop.counter0 }});"
                                    class="remove muted pull-right">
                                    <div class="fa fa-trash" title="Eliminar" alt="Eliminar"></div><span
                                        class="visible-xs"></span>
                                </a>
                            </div>

                        </div>
                        <div class="row" style="margin-top:22px !important;">
                            <div class=" p-0" style="width:6rem !important;">

                            </div>
                            <div class="col-3 pl-0">
                                <p style="margin:0px !important;">
                                    <label for="">Dia Libre</label>

                                    <select name="diaInicio-{{ forloop.counter0 }}"
                                        class="form-control form-control-sm select-form" maxlength="10"
                                        id="id_diaInicio-{{ forloop.counter0 }}">
                                        <option value="''">---------</option>
                                        {% for d in diasEntrada %}
                                        <option value="{{d.id}}">{{d.dia}}</option>
                                        {% endfor %}

                                    </select>
                                </p>
                            </div>
                            <div class="col-2 pl-0">
                                <p style="display:inline-flex !important;margin-top:17px !important;">

                                    <div class="input-group date">
                                        <input type="text" name="horaInicio-{{ forloop.counter0 }}"
                                            placeholder="Hora inicio" class="form-control form-control-sm"
                                            id="id_horaInicio-{{ forloop.counter0 }}"
                                            dp_config="{&quot;id&quot;: &quot;dp_36&quot;, &quot;picker_type&quot;: &quot;TIME&quot;, &quot;linked_to&quot;: &quot;dp_27&quot;, &quot;options&quot;: {&quot;showClose&quot;: true, &quot;showClear&quot;: true, &quot;showTodayButton&quot;: false, &quot;useCurrent&quot;: false, &quot;stepping&quot;: 5, &quot;format&quot;: &quot;HH:mm&quot;}}">
                                        <div class="input-group-addon input-group-append" data-target="#datetimepicker1"
                                            data-toggle="datetimepickerv">
                                            <div class="input-group-text"><i class="glyphicon glyphicon-time"></i></div>
                                        </div>
                                    </div>

                                </p>
                            </div>
                            <div class="col-3 pl-0">
                                <p style="margin-top:30px !important;">

                                    <select name="diaFin-{{ forloop.counter0 }}"
                                        class="form-control form-control-sm select-form" maxlength="10"
                                        id="id_diaFin-{{ forloop.counter0 }}">
                                        <option value="''">---------</option>
                                        {% for d in diasSalida %}
                                        <option value="{{d.id}}">{{d.dia}}</option>
                                        {% endfor %}

                                    </select>
                                </p>
                            </div>
                            <div class="col-2 pl-0">
                                <p style="display:inline-flex !important;margin-top:17px !important;">

                                    <div class="input-group date">
                                        <input type="text" name="horaFin-{{ forloop.counter0 }}" placeholder="Hora Fin"
                                            class="form-control form-control-sm" id="id_horaFin-{{ forloop.counter0 }}"
                                            dp_config="{&quot;id&quot;: &quot;dp_36&quot;, &quot;picker_type&quot;: &quot;TIME&quot;, &quot;linked_to&quot;: &quot;dp_27&quot;, &quot;options&quot;: {&quot;showClose&quot;: true, &quot;showClear&quot;: true, &quot;showTodayButton&quot;: false, &quot;useCurrent&quot;: false, &quot;stepping&quot;: 5, &quot;format&quot;: &quot;HH:mm&quot;}}">
                                        <div class="input-group-addon input-group-append" data-target="#datetimepicker1"
                                            data-toggle="datetimepickerv">
                                            <div class="input-group-text"><i class="glyphicon glyphicon-time"></i></div>
                                        </div>
                                    </div>
                                </p>
                            </div>


                        </div>

                    </div>
                </div>

            </div>

            <div class="modal fade" id="modalFiltro{{forloop.counter0}}" tabindex="-1" role="dialog"
                aria-labelledby="modalFiltro" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="modalFiltro">Operarios Disponibles </h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div id="jsGrid{{forloop.counter0}}"></div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}

        </div> -->




    </form>
</div>




<script type='template/Detalle'>

        <div class="row mt-2 leaveForm" id="leaveForm"  style="    margin-bottom: 30px;">
                <div class="row">
                    <div class="col-md-4">
                        <div class="row" style="margin: 0px 0px 10px 0px;">
                            <div class="col-md-4 text-center p-0">
                                <button type="button" class="btn btn-info btn-block btn-filter_operario" id="filter_operario-"
                                    name='filter_operario' style="    height: 39px;
                                                border-top-right-radius: 0px;
                                                border-bottom-right-radius: 0px;" disabled><i
                                        class="fa fa-search"></i></button>
                            </div>

                            {{form.id}}
                            <input type="hidden" id="openModal" value="{{openModal}}">
                            <input type="hidden" id="idModal" value="{{idModal}}">
                            <div class="col-md-8 p-0">
                                {{asigDetFormSet.empty_form.operario}}
                                <select name="operario-" class="form-control form-control-sm "
                                    readonly="readonly" style="height:39px !important" disabled="disabled"
                                    id="operario-">
                                    <option value=""></option>
                                    {% for ope in allOperarios %}
                                    <option value="{{ope.id}}">{{ope.nombre}} {{ope.apellido}} - {{ope.nroLegajo}}</option>
                                    {% endfor %}
                                </select>
                                </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">

                                <div class="input-group date">
                                    {{asigDetFormSet.empty_form.fechaInicio}}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group date">
                                    {{asigDetFormSet.empty_form.fechaFin}}
                                </div>
                            </div>
                        </div>
                        <div class="row" style="margin-top: 20px;">
                            <div class="col-md-6">
                                <p>
                                    <label for="">Perfil</label>
                                    <select class="form-control form-control-sm select-form"
                                        id="perfil-" style="display:none;">
                                        <option value="">---------</option>
                                        {% for perfil in perfiles %}
                                        <option value="{{perfil.id}}">{{perfil.especializacion}}</option>
                                        {% endfor %}

                                    </select>
                                    {{asigDetFormSet.empty_form.perfil}}
                                </p>


                            </div>
                            <div class="col-md-6" style="display:flex;align-items:center !important;">
                                <div class="input-group date" style="display:flex;justify-content :center !important;">
                                    <p style="display:inline-flex !important;margin:0px !important;">
                                        <label for="">Supervisor</label>
                                        <input type="checkbox" class="checkbox-supervisor" style="display:none"
                                            id="supervisor-">
                                        {{asigDetFormSet.empty_form.supervisor}}
                                    </p>

                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="col-md-8">
                        <div class="row input-horas">
                            <div class="col pl-0">
                                <div class="input-group date" style="    margin: 0px 0px 10px 0px;
                                            height: 39px;">
                                    {{asigDetFormSet.empty_form.totalHoras}}
                                </div>

                            </div>
                            <div class="col pl-0">
                                <div class="input-group date" style="margin:0px 0px 16px 0px;">
                                    {{asigDetFormSet.empty_form.lunEnt}}
                                </div>
                                <div class="input-group date">
                                        {{asigDetFormSet.empty_form.lunSal}}
                                </div>
                            </div>
                            <div class="col pl-0">
                                <div class="input-group date" style="margin:0px 0px 16px 0px;">
                                        {{asigDetFormSet.empty_form.marEnt}}
                                </div>
                                <div class="input-group date">
                                        {{asigDetFormSet.empty_form.marSal}}
                                </div>
                            </div>
                            <div class="col pl-0">
                                <div class="input-group date" style="margin:0px 0px 16px 0px;">
                                        {{asigDetFormSet.empty_form.mieEnt}}
                                </div>
                                <div class="input-group date">
                                        {{asigDetFormSet.empty_form.mieSal}}
                                </div>
                            </div>
                            <div class="col pl-0">
                                <div class="input-group date" style="margin:0px 0px 16px 0px;">
                                        {{asigDetFormSet.empty_form.jueEnt}}
                                </div>
                                <div class="input-group date">
                                        {{asigDetFormSet.empty_form.jueSal}}
                                </div>
                            </div>
                            <div class="col pl-0">
                                <div class="input-group date" style="margin:0px 0px 16px 0px;">
                                        {{asigDetFormSet.empty_form.vieEnt}}
                                </div>
                                <div class="input-group date">
                                        {{asigDetFormSet.empty_form.vieSal}}
                                </div>
                            </div>
                            <div class="col pl-0">
                                <div class="input-group date" style="margin:0px 0px 16px 0px;">
                                        {{asigDetFormSet.empty_form.sabEnt}}
                                </div>
                                <div class="input-group date">
                                        {{asigDetFormSet.empty_form.sabSal}}
                                </div>
                            </div>
                            <div class="col pl-0">
                                <div class="input-group date" style="margin:0px 0px 16px 0px;">
                                        {{asigDetFormSet.empty_form.domEnt}}
                                </div>
                                <div class="input-group date">
                                        {{asigDetFormSet.empty_form.domSal}}
                                </div>
                            </div>

                            <div class="col-1 pl-0" style="display: flex;
                                        justify-content: center;
                                        align-items: center;
                                        color: red !important;
                                        font-size: 25px;">
                                {{asigDetFormSet.empty_form.DELETE}}
                                <a href="javascript:void(0);" onclick="deleteLeaveRow(this,);"
                                class="remove muted pull-right">
                                <div class="fa fa-trash" title="Eliminar" alt="Eliminar"></div><span
                                    class="visible-xs"></span>
                                </a>
                            </div>

                        </div>
                        <div class="row" style="margin-top:22px !important;">
                            <div class=" p-0" style="width:6rem !important;">

                            </div>
                            <div class="col-3 pl-0">
                                <p style="margin:0px !important;">
                                    <label for="">Dia Libre</label>

                                    <select name="diaInicio-{{ forloop.counter0 }}" class="form-control form-control-sm select-form" maxlength="10" id="id_diaInicio-{{ forloop.counter0 }}">
                                    <option value="''">---------</option>
                                    {% for d in diasEntrada %}
                                        <option value="{{d.id}}">{{d.dia}}</option>
                                    {% endfor %}

                                </select>
                                </p>
                            </div>
                            <div class="col-2 pl-0">
                                <p style="display:inline-flex !important;margin-top:17px !important;">

                                    <div class="input-group date">
                                            <input type="text" name="horaInicio-"
                                            placeholder="Hora inicio" class="form-control form-control-sm"
                                            id="id_horaInicio-"
                                            dp_config="{&quot;id&quot;: &quot;dp_36&quot;, &quot;picker_type&quot;: &quot;TIME&quot;, &quot;linked_to&quot;: &quot;dp_27&quot;, &quot;options&quot;: {&quot;showClose&quot;: true, &quot;showClear&quot;: true, &quot;showTodayButton&quot;: false, &quot;useCurrent&quot;: false, &quot;stepping&quot;: 5, &quot;format&quot;: &quot;HH:mm&quot;}}">
                                        <div class="input-group-addon input-group-append" data-target="#datetimepicker1"
                                            data-toggle="datetimepickerv">
                                            <div class="input-group-text"><i class="glyphicon glyphicon-time"></i></div>
                                        </div>
                                    </div>

                                </p>
                            </div>
                            <div class="col-3 pl-0">
                                <p style="margin-top:30px !important;">

                                <select name="diaFin-{{ forloop.counter0 }}"
                                        class="form-control form-control-sm select-form" maxlength="10"
                                        id="id_diaFin-{{ forloop.counter0 }}">
                                        <option value="''">---------</option>
                                            {% for d in diasSalida %}
                                            <option value="{{d.id}}">{{d.dia}}</option>
                                            {% endfor %}

                                    </select>
                                </p>
                            </div>
                            <div class="col-2 pl-0">
                                <p style="display:inline-flex !important;margin-top:17px !important;">

                                    <div class="input-group date">
                                        <input type="text" name="horaFin-{{ forloop.counter0 }}" placeholder="Hora Fin"
                                            class="form-control form-control-sm" id="id_horaFin-{{ forloop.counter0 }}"
                                            dp_config="{&quot;id&quot;: &quot;dp_36&quot;, &quot;picker_type&quot;: &quot;TIME&quot;, &quot;linked_to&quot;: &quot;dp_27&quot;, &quot;options&quot;: {&quot;showClose&quot;: true, &quot;showClear&quot;: true, &quot;showTodayButton&quot;: false, &quot;useCurrent&quot;: false, &quot;stepping&quot;: 5, &quot;format&quot;: &quot;HH:mm&quot;}}">
                                        <div class="input-group-addon input-group-append" data-target="#datetimepicker1"
                                            data-toggle="datetimepickerv">
                                            <div class="input-group-text"><i class="glyphicon glyphicon-time"></i></div>
                                        </div>
                                    </div>
                                </p>
                            </div>


                        </div>

                    </div>
                </div>

            </div>
            <!-- Modal -->
            <div class="modal fade" id="modalFiltro" tabindex="-1" role="dialog"
                aria-labelledby="modalFiltro" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="modalFiltro">Operarios Disponibles </h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div id="jsGrid"></div>
                        </div>
                    </div>
                </div>
            </div>
</script>
<script>
    function formatearFecha(date) {
        console.log(date)
    }
    /**verifica los eliminados y oculta **/
    $(document).ready(function () {
        RecalcularTipoHoras();
        //RecalcularHorasV2();
        // $('input[type=checkbox]').hide()
        var cantForm = $('#id_asignaciondet_set-TOTAL_FORMS').val();
        for (var i = 0; i < cantForm; i++) {


            $('#id_asignaciondet_set-' + (i) + '-DELETE').attr('style', 'display:none !important')

            var select = $('#id_asignaciondet_set-' + (i) + '-DELETE')[0].checked;


            if ($('#id_asignaciondet_set-' + (i) + '-DELETE').is(":checked")) {
                //$('td.delete input[type=checkbox]').hide()
                $('#leaveForm-' + i).hide()

            }
            if ($('#id_asignaciondet_set-' + i + '-operario').val()) {

                $('#id_asignaciondet_set-' + i + '-domEnt').prop("readonly", true);
                $('#id_asignaciondet_set-' + i + '-domSal').prop("readonly", true);
                $('#id_asignaciondet_set-' + i + '-fecha').prop("readonly", true);
                $('#id_asignaciondet_set-' + i + '-fechaInicio').prop("readonly", true);
                $('#id_asignaciondet_set-' + i + '-fechaFin').prop("readonly", true);
                $('#filter_operario-' + i).prop("readonly", true);
                $('#id_asignaciondet_set-' + i + '-lunEnt').prop("readonly", true);
                $('#id_asignaciondet_set-' + i + '-lunSal').prop("readonly", true);
                $('#id_asignaciondet_set-' + i + '-marEnt').prop("readonly", true);
                $('#id_asignaciondet_set-' + i + '-marSal').prop("readonly", true);
                $('#id_asignaciondet_set-' + i + '-mieEnt').prop("readonly", true);
                $('#id_asignaciondet_set-' + i + '-mieSal').prop("readonly", true);
                $('#id_asignaciondet_set-' + i + '-jueEnt').prop("readonly", true);
                $('#id_asignaciondet_set-' + i + '-jueSal').prop("readonly", true);
                $('#id_asignaciondet_set-' + i + '-vieEnt').prop("readonly", true);
                $('#id_asignaciondet_set-' + i + '-vieSal').prop("readonly", true);
                $('#id_asignaciondet_set-' + i + '-sabEnt').prop("readonly", true);
                $('#id_asignaciondet_set-' + i + '-sabSal').prop("readonly", true);
                $('#id_asignaciondet_set-' + i + '-perfil').attr("style", "display:none");
                $('#id_asignaciondet_set-' + i + '-supervisor').attr("style", "display:none");
                $('#perfil-' + i).attr("style", "display:block");
                $('#perfil-' + i).attr("disabled", "disabled");
                $('#supervisor-' + i).attr("style", "display:block;margin: 8px 25px;");
                $('#supervisor-' + i).attr("disabled", "disabled");
                $('#guardar').prop("disabled", false);
                //Los siguientes campos seràn deshabilitados solo si tienen datos               
            }
            else {
                $('#guardar').prop("disabled", true);
            }
        }
    });
</script>
<script>
    $(document).on("change", ".perfil-combo", function () {
        //RecalcularHorasV2();
        RecalcularTipoHoras();
    });
    $(document).on("dp.change", ".examDate", function () {
        //RecalcularHorasV2();
        RecalcularTipoHoras();
    });
    $(document).on("dp.change", ".examTime", function () {
        //RecalcularHorasV2();
        RecalcularTipoHoras();
    });
</script>

<script>
    function guardarAsignacion() {
        var error = true;
        if (

            (timeInHours($('#sumAll_resto').val()) >= 0) &&
            (timeInHours($('#res_sem_diu').val()) >= 0 || isNaN(timeInHours($('#res_sem_diu').val()))) &&
            (timeInHours($('#res_sem_noc').val()) >= 0 || isNaN(timeInHours($('#res_sem_noc').val()))) &&
            (timeInHours($('#res_dom_diu').val()) >= 0 || isNaN(timeInHours($('#res_dom_diu').val()))) &&
            (timeInHours($('#res_dom_noc').val()) >= 0 || isNaN(timeInHours($('#res_dom_noc').val())))
        ) { error = false; }
        debugger;

        token = '{{csrf_token}}';
        startLoader();
        $.ajax({
            type: "POST",
            url: "/reingenieria/asignacion/guardarAsignacion",
            data: $("#formulario").serialize() + "&csrfmiddlewaretoken=" + token + "&error=" + error
        }).done(function (result) {
            endLoader();
            if (result.codigo == 0) {
                document.location.href = "/reingenieria/asignacion/listar";
                setMessageAlert("No se pudo guardar la Asignación");
            } else if (result.codigo == 1) {
                setMessageAlert(result.mensaje);
                $('html, body').animate({ scrollTop: 0 }, 'fast');
            }
        })
    }
    function verificarDiaLibre(idOperario, id) {
        var body = {}
        body.operarios = "[" + idOperario + "]";
        $.ajax({
            type: "GET",
            url: "/reingenieria/asignacion/diasLibres",
            data: body
        }).done(function (result) {
            diasLibres = result.dato;
            if (diasLibres) {
                if (diasLibres.length > 0) {
                    var entrada = diasLibres[0].diasLibres.entrada;
                    var salida = diasLibres[0].diasLibres.salida;
                    var tieneFechaInicio = setDiasLibres(id, entrada.label, 0);
                    var tieneDiaFin = setDiasLibres(id, salida.label, 1);
                    if (entrada.hora != "") {
                        $("#id_horaInicio-" + id).val(entrada.hora.substr(0, 5));
                        $('#id_horaInicio-' + id).prop("readonly", true);
                    }
                    if (salida.hora != "") {
                        $("#id_horaFin-" + id).val(salida.hora.substr(0, 5));
                        $('#id_horaFin-' + id).prop("readonly", true);
                    }
                    if (tieneFechaInicio) {
                        $('#id_diaInicio-' + id).attr("disabled", "disabled");
                    }
                    if (tieneDiaFin) {
                        $('#id_diaFin-' + id).attr("disabled", "disabled");
                    }
                }

            }

        })
    }
    function setDiasLibres(id, label, mode) {
        //Mode 0 es para setear dia inicio, mode 1 es para setear dia fin
        if (mode == 0) {
            var select = $('#id_diaInicio-' + (id))[0];
        } else {
            var select = $('#id_diaFin-' + (id))[0];
        }
        for (var j = 0; j < select.length; j++) {
            if ($(select[j]).val() == label) {
                $(select).val(label);
                return true;
            } else {
                $(select[j]).removeAttr('selected');
            }
        }
        return false;
    }
</script>

<script>
    function goToAddDetalle() {
        console.log("se va a add detalle");
        var puntoServicio_id = $('#id_puntoServicio').val()
        document.location.href = "/reingenieria/asignacion/agregarDetalle/" + puntoServicio_id;
    }

    // $(document).ready(function () {
    //     var body = {}
    //     var diasLibres = []
    //     var cantForm = $('#id_asignaciondet_set-TOTAL_FORMS').val();
    //     var identificadores = [];
    //     for (var i = 0; i < cantForm; i++) {
    //         if ($('#id_asignaciondet_set-' + i + '-operario').val()) {
    //             identificadores.push(($('#id_asignaciondet_set-' + i + '-operario').val()));
    //         }
    //     }
    //     body.operarios = "[" + identificadores + "]";
    //     $.ajax({
    //         type: "GET",
    //         url: "/reingenieria/asignacion/diasLibres",
    //         data: body
    //     }).done(function (result) {
    //         diasLibres = result;
    //         searchDiasLibres(diasLibres.dato)
    //     })

    //     function searchDiasLibres(diasLibres) {
    //         for (var i = 0; i < diasLibres.length; i++) {
    //             var idOpe = diasLibres[i].operario_id;
    //             for (id = 0; id < cantForm; id++) {
    //                 if (idOpe == $("#id_asignaciondet_set-" + id + "-operario").val()) {
    //                     //Existe operario
    //                     var entrada = diasLibres[i].diasLibres.entrada;
    //                     var salida = diasLibres[i].diasLibres.salida;
    //                     var tieneFechaInicio = setDiasLibres(id, entrada.label, 0);
    //                     var tieneDiaFin = setDiasLibres(id, salida.label, 1);
    //                     if (entrada.hora != "") {
    //                         $("#id_horaInicio-" + id).val(entrada.hora.substr(0, 5));
    //                         $('#id_horaInicio-' + id).prop("readonly", true);
    //                     }
    //                     if (salida.hora != "") {
    //                         $("#id_horaFin-" + id).val(salida.hora.substr(0, 5));
    //                         $('#id_horaFin-' + id).prop("readonly", true);
    //                     }
    //                     if (tieneFechaInicio) {
    //                         $('#id_diaInicio-' + id).attr("disabled", "disabled");
    //                     }
    //                     if (tieneDiaFin) {
    //                         $('#id_diaFin-' + id).attr("disabled", "disabled");
    //                     }
    //                 }
    //             }
    //         }
    //     }
    //     function setDiasLibres(id, label, mode) {
    //         //Mode 0 es para setear dia inicio, mode 1 es para setear dia fin
    //         if (mode == 0) {
    //             var select = $('#id_diaInicio-' + (id))[0];
    //         } else {
    //             var select = $('#id_diaFin-' + (id))[0];
    //         }
    //         for (var j = 0; j < select.length; j++) {
    //             if ($(select[j]).val() == label) {
    //                 $(select).val(label);
    //                 return true;
    //             } else {
    //                 $(select[j]).removeAttr('selected');
    //             }
    //         }
    //         return false;
    //     }


    // })
</script>

<script>
    $(document).ready(function () {
        RecalcularHorasLunSabADom();
        var cantForm = $('#id_asignaciondet_set-TOTAL_FORMS').val();
        setClassAll(cantForm - 1);
        //EVENTO CHANGE PARA TIMES POR DEFECTO
        $('.input-group.time').each(function () {
            $(this).datetimepicker().on('dp.change', function (e) {
                //RecalcularHorasV2();
                RecalcularTipoHoras();
            })
        });
        $('.input-group.time').each(function () {
            $(this).datetimepicker().on('dp.change', function (e) {
                //RecalcularHorasV2();
                RecalcularTipoHoras();
            })
        });

        for (var i = 0; i < cantForm; i++) {
            var idOpe = $('#id_asignaciondet_set-' + (i) + '-operario').val();
            var idPerfil = $('#id_asignaciondet_set-' + (i) + '-perfil').val();
            var supervisor = $('#id_asignaciondet_set-' + (i) + '-supervisor');
            if (supervisor[0].checked) {
                var selectSupervisor = $('#supervisor-' + (i))[0];

                selectSupervisor.checked = true;
            }
            var select = $('#operario-' + (i))[0];
            var selectPerfil = $('#perfil-' + (i))[0];
            for (var j = 0; j < select.length; j++) {
                if ($(select[j]).val() == idOpe) {
                    $(select[j]).attr("selected", "selected");

                } else {
                    $(select[j]).removeAttr('selected');
                }
            }
            for (var j = 0; j < selectPerfil.length; j++) {
                if ($(selectPerfil[j]).val() == idPerfil) {
                    $(selectPerfil[j]).attr("selected", "selected");
                } else {
                    $(selectPerfil[j]).removeAttr('selected');
                }
            }
        }

        function setClassAll(id) {
            $("#id_asignaciondet_set-" + (id) + "-lunEnt").parent('div').addClass('time');
            $("#id_asignaciondet_set-" + (id) + "-lunSal").parent('div').addClass('time');
            $("#id_asignaciondet_set-" + (id) + "-marEnt").parent('div').addClass('time');
            $("#id_asignaciondet_set-" + (id) + "-marSal").parent('div').addClass('time');
            $("#id_asignaciondet_set-" + (id) + "-mieEnt").parent('div').addClass('time');
            $("#id_asignaciondet_set-" + (id) + "-mieSal").parent('div').addClass('time');
            $("#id_asignaciondet_set-" + (id) + "-jueEnt").parent('div').addClass('time');
            $("#id_asignaciondet_set-" + (id) + "-jueSal").parent('div').addClass('time');
            $("#id_asignaciondet_set-" + (id) + "-vieEnt").parent('div').addClass('time');
            $("#id_asignaciondet_set-" + (id) + "-vieSal").parent('div').addClass('time');
            $("#id_asignaciondet_set-" + (id) + "-sabEnt").parent('div').addClass('time');
            $("#id_asignaciondet_set-" + (id) + "-sabSal").parent('div').addClass('time');
            $("#id_asignaciondet_set-" + (id) + "-domEnt").parent('div').addClass('time');
            $("#id_asignaciondet_set-" + (id) + "-domSal").parent('div').addClass('time');
        }
        // var cant_horas = $('.totalHoras-asignaciones').length;
        // var total_horas = $('.totalHoras-asignaciones');
        // var total = 0;

        // for (let index = 0; index < total_horas.length; index++) {
        //     total = total + parseFloat(total_horas[index].defaultValue);
        // }
        // console.log("TOTAL",total)
        // var horas = "";
        // if (String(total).includes(".")) {
        //     horas = (String(total)).split(".")[0];
        //     minutos = "0." + (String(total)).split(".")[1];
        //     $('#id_totalasignado').val(horas + ":" + String(parseFloat(minutos) * 60));
        // } else {
        //     horas = (String(total)).split(".")[0];
        //     $('#id_totalasignado').val(horas + ":00");
        // }
    });
    function updateTotalAsignado(){
      
        var cant_horas = $('.totalHoras-asignaciones').length;
        var total_horas = $('.totalHoras-asignaciones');
        var total = 0;

        for (let index = 0; index < total_horas.length; index++) {
            total = total + parseFloat(total_horas[index].defaultValue);
        }
        var horas = "";
        if (String(total).includes(".")) {
            horas = (String(total)).split(".")[0];
            minutos = "0." + (String(total)).split(".")[1];
            $('#id_totalasignado').val(horas + ":" + String(parseFloat(minutos) * 60));
        } else {
            horas = (String(total)).split(".")[0];
            $('#id_totalasignado').val(horas + ":00");
        }
         $('#sumAll_resto').val(hoursToString(timeInHours($('#sumAll_total').val()) - timeInHours($('#id_totalasignado').val())));
   
    }
</script>
<script>
    function buscarOperario(id) {
        //Seteamos action
        //document.getElementById('action').value = 'filter_operario-' + id;
        //hacemos submit
        //document.getElementById('formulario').submit();

        if (id) {
            $('#modalFiltro' + id).modal('show');
            $("#jsGrid" + id).jsGrid({
                height: "80%",
                width: "100%",
                /*filtering: true,
                inserting: true,
                editing: true,
                sorting: true,
                paging: true,
                autoload: true,*/
                filtering: true,
                inserting: false,
                editing: false,
                sorting: true,
                paging: true,
                autoload: true,
                pageSize: 5,
                pagerFormat: "Páginas: {first} {prev} {pages} {next} {last}    {pageIndex} de {pageCount}",
                pageButtonCount: 1,
                pagePrevText: "Anterior",
                pageNextText: "Siguiente",
                pageFirstText: "Primera",
                pageLastText: "Ultima",
                noDataContent: "No se han encontrado registros que coincidan con la busqueda",
                deleteConfirm: "Desea eliminar el registro?",
                loadMessage: "Por favor, espere...",
                invalidMessage: "Datos no válidos",
                controller: {
                    loadData: function (filter) {
                        var d = $.Deferred();
                        filter.idPunto = $('#id_puntoServicio').val();
                        filter.totalHorasProc = $('#id_asignaciondet_set-' + id + '-totalHoras').val();
                        filter.lunEnt = $('#id_asignaciondet_set-' + id + '-lunEnt').val();
                        filter.lunSal = $('#id_asignaciondet_set-' + id + '-lunSal').val();
                        filter.marEnt = $('#id_asignaciondet_set-' + id + '-marEnt').val();
                        filter.marSal = $('#id_asignaciondet_set-' + id + '-marSal').val();
                        filter.mieEnt = $('#id_asignaciondet_set-' + id + '-mieEnt').val();
                        filter.mieSal = $('#id_asignaciondet_set-' + id + '-mieSal').val();
                        filter.jueEnt = $('#id_asignaciondet_set-' + id + '-jueEnt').val();
                        filter.jueSal = $('#id_asignaciondet_set-' + id + '-jueSal').val();
                        filter.vieEnt = $('#id_asignaciondet_set-' + id + '-vieEnt').val();
                        filter.vieSal = $('#id_asignaciondet_set-' + id + '-vieSal').val();
                        filter.sabEnt = $('#id_asignaciondet_set-' + id + '-sabEnt').val();
                        filter.sabSal = $('#id_asignaciondet_set-' + id + '-sabSal').val();
                        filter.domEnt = $('#id_asignaciondet_set-' + id + '-domEnt').val();
                        filter.domSal = $('#id_asignaciondet_set-' + id + '-domSal').val();
                        filter.perfilproc = $('#id_asignaciondet_set-' + id + '-perfil').val();
                        filter.supervisor = $('#id_asignaciondet_set-' + id + '-supervisor')[0].checked;
                        filter.fechaIni = $('#id_asignaciondet_set-' + id + '-fechaInicio').val();
                        filter.fechaFin = $('#id_asignaciondet_set-' + id + '-fechaFin').val();
                        filter.horaInicio = $('#id_horaInicio-' + id).val();
                        filter.horaFin = $('#id_horaFin-' + id).val();
                        filter.diaInicio = $('#id_diaInicio-' + id).val();
                        filter.diaFin = $('#id_diaFin-' + id).val();
                        $.ajax({
                            type: "GET",
                            url: "/reingenieria/asignacion/asignar/operarios",
                            data: filter
                        }).done(function (result) {

                            var j = id;
                            var index = 1;
                            var lunEntAnt = ""
                            var lunSalAnt = ""
                            var marEntAnt = ""
                            var marSalAnt = ""
                            var mieSalAnt = ""
                            var mieEntAnt = ""
                            var jueEntAnt = ""
                            var jueSalAnt = ""
                            var vieSalAnt = ""
                            var vieEntAnt = ""
                            var sabEntAnt = ""
                            var sabSalAnt = ""
                            var domEntAnt = ""
                            var domSalAnt = ""
                            var fechaIniAnt = ""
                            var fechaFinAnt = ""
                            if (result.length > 0) {
                                var operarios = result;
                                if (j > 0) {
                                    index = 1;
                                    while (index <= j) {
                                        operarios = result;
                                        lunEntAnt = ""
                                        lunSalAnt = ""
                                        marEntAnt = ""
                                        marSalAnt = ""
                                        mieSalAnt = ""
                                        mieEntAnt = ""
                                        jueEntAnt = ""
                                        jueSalAnt = ""
                                        vieSalAnt = ""
                                        vieEntAnt = ""
                                        sabEntAnt = ""
                                        sabSalAnt = ""
                                        domEntAnt = ""
                                        domSalAnt = ""
                                        fechaIniAnt = ""
                                        fechaFinAnt = ""
                                        if (!$("#id_asignaciondet_set-" + (index - 1) + "-DELETE")[0].checked) {
                                            if ($('#id_asignaciondet_set-' + (index - 1) + '-fechaInicio').val())
                                                fechaIniAnt = $('#asignaciondet_set-' + (index - 1) + '-fechaInicio').val()
                                            if ($('#id_asignaciondet_set-' + (index - 1) + '-fechaFin').val())
                                                fechaFinAnt = $('#id_asignaciondet_set-' + (index - 1) + '-fechaFin').val()
                                            if ($('#id_asignaciondet_set-' + (index - 1) + '-lunEnt').val())
                                                lunEntAnt = $('#id_asignaciondet_set-' + (index - 1) + '-lunEnt').val()
                                            if ($('#id_asignaciondet_set-' + (index - 1) + '-lunSal').val())
                                                lunSalAnt = $('#id_asignaciondet_set-' + (index - 1) + '-lunSal').val()
                                            if ($('#id_asignaciondet_set-' + (index - 1) + '-marEnt').val())
                                                marEntAnt = $('#id_asignaciondet_set-' + (index - 1) + '-marEnt').val()
                                            if ($('#id_asignaciondet_set-' + (index - 1) + '-marSal').val())
                                                marSalAnt = $('#id_asignaciondet_set-' + (index - 1) + '-marSal').val()
                                            if ($('#id_asignaciondet_set-' + (index - 1) + '-mieEnt').val())
                                                mieEntAnt = $('#id_asignaciondet_set-' + (index - 1) + '-mieEnt').val()
                                            if ($('#id_asignaciondet_set-' + (index - 1) + '-mieSal').val())
                                                mieSalAnt = $('#id_asignaciondet_set-' + (index - 1) + '-mieSal').val()
                                            if ($('#id_asignaciondet_set-' + (index - 1) + '-jueEnt').val())
                                                jueEntAnt = $('#id_asignaciondet_set-' + (index - 1) + '-jueEnt').val()
                                            if ($('id_asignaciondet_set-' + (index - 1) + '-jueSal').val())
                                                jueSalAnt = $('#id_asignaciondet_set-' + (index - 1) + '-jueSal').val()
                                            if ($('#id_asignaciondet_set-' + (index - 1) + '-vieEnt').val())
                                                vieEntAnt = $('#id_asignaciondet_set-' + (index - 1) + '-vieEnt').val()
                                            if ($('#id_asignaciondet_set-' + (index - 1) + '-vieSal').val())
                                                vieSalAnt = $('#id_asignaciondet_set-' + (index - 1) + '-vieSal').val()
                                            if ($('#id_asignaciondet_set-' + (index - 1) + '-sabEnt').val())
                                                sabEntAnt = $('#id_asignaciondet_set-' + (index - 1) + '-sabEnt').val()
                                            if ($('#id_asignaciondet_set-' + (index - 1) + '-sabSal').val())
                                                sabSalAnt = $('#id_asignaciondet_set-' + (index - 1) + '-sabSal').val()
                                            if ($('#id_asignaciondet_set-' + (index - 1) + '-domEnt').val())
                                                domEntAnt = $('#id_asignaciondet_set-' + (index - 1) + '-domEnt').val()
                                            if ($('#id_asignaciondet_set-' + (index - 1) + '-domSal').val())
                                                domSalAnt = $('#id_asignaciondet_set-' + (index - 1) + '-domSal').val()

                                            if (filter.lunEnt && lunEntAnt && lunSalAnt && ((filter.lunEnt >= lunEntAnt && filter.lunEnt <= lunSalAnt) || (filter.lunSal >= lunEntAnt && (filter.lunSal <= lunSalAnt || filter.lunSal >= lunSalAnt)))) {

                                                if (filter.fechaIni == fechaIniAnt || filter.fechaFin == fechaFinAnt) {

                                                    id_operario = $('#id_asignaciondet_set-' + (index - 1) + '-operario').val()
                                                    if (id_operario != '') {
                                                        for (var i = 0; i < operarios.length; i++) {
                                                            if (operarios[i].pk == id_operario) {
                                                                operarios.splice(i, 1);

                                                                break
                                                            }
                                                        }
                                                    }
                                                }
                                            } else if (filter.marEnt && marEntAnt && marSalAnt && ((filter.marEnt >= marEntAnt && filter.marEnt <= marSalAnt) || (filter.marSal >= marEntAnt && (filter.marSal <= marSalAnt || filter.marSal >= marSalAnt)))) {

                                                if (filter.fechaIni == fechaIniAnt || filter.fechaFin == fechaFinAnt) {

                                                    id_operario = $('#id_asignaciondet_set-' + (index - 1) + '-operario').val()

                                                    if (id_operario != '') {
                                                        for (var i = 0; i < operarios.length; i++) {
                                                            if ((operarios[i].pk) == (id_operario)) {
                                                                operarios.splice(i, 1);
                                                                break
                                                            }
                                                        }
                                                    }
                                                }
                                            } else if (filter.mieEnt && mieEntAnt && mieSalAnt && ((filter.mieEnt >= mieEntAnt && filter.mieEnt <= mieSalAnt) || (filter.mieSal >= mieEntAnt && (filter.mieSal <= mieSalAnt || filter.mieSal >= mieSalAnt)))) {
                                                console.log("miercoles");
                                                if (filter.fechaIni == fechaIniAnt || filter.fechaFin == fechaFinAnt) {

                                                    id_operario = $('#id_asignaciondet_set-' + (index - 1) + '-operario').val()

                                                    if (id_operario != '') {
                                                        for (var i = 0; i < operarios.length; i++) {
                                                            if ((operarios[i].pk) == (id_operario)) {
                                                                operarios.splice(i, 1);
                                                                break
                                                            }
                                                        }
                                                    }
                                                }
                                            } else if (filter.jueEnt && jueEntAnt && jueSalAnt && ((filter.jueEnt >= jueEntAnt && filter.jueEnt <= jueSalAnt) || (filter.jueSal >= jueEntAnt && (filter.jueSal <= jueSalAnt || filter.jueSal >= jueSalAnt)))) {
                                                console.log("jueves");
                                                if (filter.fechaIni == fechaIniAnt || filter.fechaFin == fechaFinAnt) {

                                                    id_operario = $('#id_asignaciondet_set-' + (index - 1) + '-operario').val()

                                                    if (id_operario != '') {
                                                        for (var i = 0; i < operarios.length; i++) {
                                                            if ((operarios[i].pk) == (id_operario)) {
                                                                operarios.splice(i, 1);
                                                                break
                                                            }
                                                        }
                                                    }
                                                }
                                            } else if (filter.vieEnt && vieEntAnt && vieSalAnt && ((filter.vieEnt >= vieEntAnt && filter.vieEnt <= vieSalAnt) || (filter.vieSal >= vieEntAnt && (filter.vieSal <= vieSalAnt || filter.vieSal >= vieSalAnt)))) {
                                                console.log("viernes");
                                                if (filter.fechaIni == fechaIniAnt || filter.fechaFin == fechaFinAnt) {

                                                    id_operario = $('#id_asignaciondet_set-' + (index - 1) + '-operario').val()

                                                    if (id_operario != '') {
                                                        for (var i = 0; i < operarios.length; i++) {
                                                            if ((operarios[i].pk) == (id_operario)) {
                                                                operarios.splice(i, 1);
                                                                break
                                                            }
                                                        }
                                                    }
                                                }
                                            } else if (filter.sabEnt && sabEntAnt && sabSalAnt && ((filter.sabEnt >= sabEntAnt && filter.sabEnt <= sabSalAnt) || (filter.sabSal >= sabEntAnt && (filter.sabSal <= sabSalAnt || filter.sabSal >= sabSalAnt)))) {
                                                console.log("sabado");
                                                if (filter.fechaIni == fechaIniAnt || filter.fechaFin == fechaFinAnt) {

                                                    id_operario = $('#id_asignaciondet_set-' + (index - 1) + '-operario').val()

                                                    if (id_operario != '') {
                                                        for (var i = 0; i < operarios.length; i++) {
                                                            if ((operarios[i].pk) == (id_operario)) {
                                                                operarios.splice(i, 1);
                                                                break
                                                            }
                                                        }
                                                    }
                                                }
                                            } else if (filter.domEnt && domEntAnt && domSalAnt && ((filter.domEnt >= domEntAnt && filter.domEnt <= domSalAnt) || (filter.domSal >= domEntAnt && (filter.domSal <= domSalAnt || filter.domSal >= domSalAnt)))) {
                                                console.log("domingo");
                                                if (filter.fechaIni == fechaIniAnt || filter.fechaFin == fechaFinAnt) {

                                                    id_operario = $('#id_asignaciondet_set-' + (index - 1) + '-operario').val()

                                                    if (id_operario != '') {
                                                        for (var i = 0; i < operarios.length; i++) {
                                                            if ((operarios[i].pk) == (id_operario)) {
                                                                operarios.splice(i, 1);
                                                                break
                                                            }
                                                        }
                                                    }
                                                }
                                            }

                                        }
                                        index++;

                                    }

                                }

                            }
                            result = operarios;
                            d.resolve($.map(result, function (item) {
                                return $.extend(item.fields, { id: item.pk });
                            }));
                        });

                        return d.promise();
                    }

                },
                rowClick: function (e) {
                    var ope = e.item.id;
                    var nombres = e.item.nombres;
                    var select = $('#operario-' + id)[0];
                    var perfilSelect = $('#perfil-' + id)[0];
                    var idPerfil = $('#id_asignaciondet_set-' + (id) + '-perfil').val();
                    var selectPerfil = $('#perfil-' + (id))[0];
                    verificarDiaLibre(ope, id);
                    $('#guardar').prop("disabled", false);

                    $('#id_asignaciondet_set-' + id + '-operario').val(ope);
                    for (var i = 0; i < select.length; i++) {

                        if ($(select[i]).val() == ope) {
                            $(select[i]).attr("selected", "selected");
                        } else {
                            $(select[i]).removeAttr('selected');
                        }
                    }
                    for (var j = 0; j < selectPerfil.length; j++) {
                        if ($(selectPerfil[j]).val() == idPerfil) {
                            $(selectPerfil[j]).attr("selected", "selected");
                        } else {
                            $(selectPerfil[j]).removeAttr('selected');
                        }
                    }
                    var supervisor = $('#id_asignaciondet_set-' + (id) + '-supervisor');
                    if (supervisor[0].checked) {
                        var selectSupervisor = $('#supervisor-' + (id))[0];
                        selectSupervisor.checked = true;
                    }
                    $('#id_asignaciondet_set-' + id + '-operario')
                    $('#nombres-' + id + '-operario').val(decodeURIComponent(nombres));
                    $('#modalFiltro' + id).modal('hide');

                    $('#id_asignaciondet_set-' + id + '-domEnt').prop("readonly", true);
                    $('#id_asignaciondet_set-' + id + '-domSal').prop("readonly", true);
                    $('#id_asignaciondet_set-' + id + '-fecha').prop("readonly", true);
                    $('#id_asignaciondet_set-' + id + '-fechaInicio').prop("readonly", true);
                    $('#id_asignaciondet_set-' + id + '-fechaFin').prop("readonly", true);
                    $('#filter_operario-' + id).prop("readonly", true);
                    $('#id_asignaciondet_set-' + id + '-lunEnt').prop("readonly", true);
                    $('#id_asignaciondet_set-' + id + '-lunSal').prop("readonly", true);
                    $('#id_asignaciondet_set-' + id + '-marEnt').prop("readonly", true);
                    $('#id_asignaciondet_set-' + id + '-marSal').prop("readonly", true);
                    $('#id_asignaciondet_set-' + id + '-mieEnt').prop("readonly", true);
                    $('#id_asignaciondet_set-' + id + '-mieSal').prop("readonly", true);
                    $('#id_asignaciondet_set-' + id + '-jueEnt').prop("readonly", true);
                    $('#id_asignaciondet_set-' + id + '-jueSal').prop("readonly", true);
                    $('#id_asignaciondet_set-' + id + '-vieEnt').prop("readonly", true);
                    $('#id_asignaciondet_set-' + id + '-vieSal').prop("readonly", true);
                    $('#id_asignaciondet_set-' + id + '-sabEnt').prop("readonly", true);
                    $('#id_asignaciondet_set-' + id + '-sabSal').prop("readonly", true);
                    $('#id_asignaciondet_set-' + id + '-perfil').attr("style", "display:none");
                    $('#id_asignaciondet_set-' + id + '-supervisor').attr("style", "display:none");
                    $('#perfil-' + id).attr("style", "display:block");
                    $('#perfil-' + id).attr("disabled", "disabled");
                    $('#supervisor-' + id).attr("style", "display:block;margin: 8px 25px;");
                    $('#supervisor-' + id).attr("disabled", "disabled");
                    //Los siguientes campos seràn deshabilitados solo si tienen datos
                    if ($('#id_diaInicio-' + id).val() != "''") {
                        $('#id_diaInicio-' + id).attr("disabled", "disabled");
                    }
                    if ($('#id_horaInicio-' + id).val()) {
                        $('#id_horaInicio-' + id).prop("readonly", true);
                    }
                    if ($('#id_diaFin-' + id).val() != "''") {
                        $('#id_diaFin-' + id).attr("disabled", "disabled");
                    }
                    if ($('#id_horaFin-' + id).val()) {
                        $('#id_horaFin-' + id).prop("readonly", true);
                    }
                    $('#modalFiltro' + id).modal('hide');
                },

                fields: [
                    { name: "nombres", type: "text", width: 150, title: "Nombre" },
                    { name: "nroLegajo", type: "text", width: 150, title: "Legajo" },
                    { name: "antiguedad", type: "text", width: 150, title: "Antiguedad (años)" },
                    { name: "nombres_puntoServicio", type: "text", width: 150, title: "Otros contratos" },
                    { name: "totalHoras", type: "text", width: 150, title: "Total horas" },
                    { name: "perfil", type: "text", width: 150, title: "Perfil" }
                ]
            });
        }
    }
</script>
<script>
    //BUSCA OPERARIOS Y ABRE MODAL AL APRETAR BOTON 'BUSCAR'
    $(document).on('click', '.btn-filter_operario', function () {
        id = $(this)[0].id;
        buscarOperario(id[16]);
    })

    //ELIMINA UNA ASIGNACION YA SEA TEMPORAL O CONFIRMADA
    function eliminarRegistro(id) {
        if (confirm("Estas seguro que desea borrar el registro?")) {
            startLoader();
            tipo = $('#' + id).val();
            $.ajax({
                type: "POST",
                url: "/reingenieria/asignacion/eliminar/" + id + "/",
                data: { "tipo": $('#' + id + '-eliminar').val(), csrfmiddlewaretoken: '{{csrf_token}}' }
            }).done(function (result) {
                endLoader();
                if (result.codigo == 0) {
                    console.log("exito");
                    location.reload();
                } else {
                    console.log("error");
                }

            });
        }
    }
    function escondeRegistrosBorrados(id_asig,index) {
        $('#' + id_asig).addClass('d-none');
        $('#totalhoras-'+index);
    }
    //VER UNA ASIGNACION YA SEA TEMPORAL O CONFIRMADA
    function verRegistro(id) {
        tipo = $('#' + id +"-eliminar").val();
        localStorage.setItem('tipo-asignacion',tipo); 
        localStorage.setItem('id-signacion',id);
        id_punto = $('#id_puntoServicio').val();
        document.location.href = "/reingenieria/asignacion/verDetalle/"+id_punto;
    }

</script>

</div>




<script>
    /**
     * Number.prototype.format(n, x, s, c)
     * 
     * @param integer n: length of decimal
     * @param integer x: length of whole part
     * @param mixed   s: sections delimiter
     * @param mixed   c: decimal delimiter
     */
    Number.prototype.format = function (n, x, s, c) {
        var re = '\\d(?=(\\d{' + (x || 3) + '})+' + (n > 0 ? '\\D' : '$') + ')',
            num = this.toFixed(Math.max(0, ~~n));

        return (c ? num.replace('.', c) : num).replace(new RegExp(re, 'g'), '$&' + (s || ','));
    };

    function pad(d) {
        return (d < 10) ? '0' + d.toString() : d.toString();
    }

    function timeInHours(str) {
        var sp = str.split(":");
        return parseInt(sp[0]) + (parseFloat(sp[1] / 60));
    }

    function hoursToString(h) {

        if (h < 0) {
            return "-" + hoursToString(h * -1);
        }
        var hours = Math.floor(h);
        var minutes = ((h - hours) * 60).toFixed(0);
        
        return pad(hours) + ":" + pad(minutes);
    }

    function SumHrMin(h1, h2) {
        var sp = h1.split(":");
        var hora1 = sp[0];
        var min1 = sp[1];

        sp = h2.split(":");
        var hora2 = sp[0];
        var min2 = sp[1];

        var hora_total = parseInt(hora1) + parseInt(hora2);
        var min_pre = parseInt(min1) + parseInt(min2);

        var horas_adicionales = Math.floor((min_pre / 60));
        hora_total += horas_adicionales;
        var min_total = (min_pre - (horas_adicionales * 60));

        return hora_total + ":" + pad(min_total);
    }

    function obtenerNumeroId(id) {
        var sp = id.split("-");
        return sp[1];
    }

    function mayor(n1, n2) {
        /* 
        retorna 1 si n1 es mayor a n2
        retorna 0 si n1 es igual a n2
        retorna -1 si n1 es menor a n2
        */
        if (timeInHours(n1) > timeInHours(n2)) {
            return 1;
        } else if (timeInHours(n1) == timeInHours(n2)) {
            return 0;
        } else if (timeInHours(n1) < timeInHours(n2)) {
            return -1;
        }

    }

    function obtenerNocturnas(Ent, Sal) {
        total_horas_nocturnas = '00:00'

        //Determinamos las horas diurnas y nocturnas
        var limiteInferior = '06:00';
        var limiteSuperior = '20:00';


        if (mayor(limiteInferior, Ent) == 1) {
            var subLimiteSuperior = limiteInferior;

            if (mayor(subLimiteSuperior, Sal) == 1) {
                subLimiteSuperior = Sal;
            }

            temp_NocturnasDecimal = timeInHours(subLimiteSuperior) - timeInHours(Ent);
            total_horas_nocturnas = SumHrMin(total_horas_nocturnas, hoursToString(temp_NocturnasDecimal));

        } else if (mayor(Sal, limiteSuperior) == 1) {
            var subLimiteInferior = limiteSuperior;

            if (mayor(Ent, subLimiteInferior) == 1) {
                subLimiteInferior = Ent;
            }

            temp_NocturnasDecimal = timeInHours(Sal) - timeInHours(subLimiteInferior);
            total_horas_nocturnas = SumHrMin(total_horas_nocturnas, hoursToString(temp_NocturnasDecimal));
        }

        return total_horas_nocturnas;

    }

    function deleteLeaveRow(deleteLink, id) {
        // $("#leaveForm-" + id).remove();
        if (confirm("Estas seguro que desea borrar el registro?")) {
            $(deleteLink).closest('.leaveForm').hide();
            if (typeof id == 'undefined') {
                var id_boton = deleteLink.id;
                var id_clean = id_boton.substring(10);
                id = id_clean
            }

            $("#id_asignaciondet_set-" + id + "-DELETE").prop("checked", true);

            //document.getElementById('action').value = 'btn_eliminar';
            //hacemos submit
            //document.getElementById('formulario').submit();
            //$("#leaveForm-" + id).hide();
            $('#leaveForm-' + id).css('display:none !important')
            /**se verifica en caso que haya sido el primer elemento eliminado y ya no queda nada**/
            verificarGuardar();

            //RecalcularHorasV2();
            RecalcularTipoHoras();

        }


    }
    function verificarGuardar() {
        var totalDetalle = $('.row-table').length;
        var totalDet = parseInt(totalDetalle, 10);
        var countDelete = 0;
        /**estado inicial**/
        $('#guardar').prop("disabled", false);
        for (var i = 0; i < totalDet; i++) {
            if ($('#leaveForm-' + i).css('display') != 'none') {
                if ($('#id_asignaciondet_set-' + i + '-operario').val() == "") {
                    $('#guardar').prop("disabled", true);
                    break;
                }
            }
            else {
                countDelete++;
            }
        }
        if (countDelete == totalDet) {
            $('#guardar').prop("disabled", true);
        }
    }
    function habilitarBusqueda(id) {
        var formisValid = false;
        var fechasValid = false;
        var horasValid = false;
        if ($('#id_asignaciondet_set-' + id + '-fechaInicio').val()) {
            fechasValid = true;
        }
        hasPerfil = $('#id_asignaciondet_set-' + i + '-perfil').val();
        //Lunes
        var lunEnt = $('#id_asignaciondet_set-' + i + '-lunEnt').val();
        var lunSal = $('#id_asignaciondet_set-' + i + '-lunSal').val();
        var totalLunes = hoursToString(timeInHours(lunSal) - timeInHours(lunEnt));
        if (!(totalLunes == 'NaN:NaN')) {
            horasValid = true;
        }

        //Martes
        var marEnt = $('#id_asignaciondet_set-' + i + '-marEnt').val();
        var marSal = $('#id_asignaciondet_set-' + i + '-marSal').val();
        var totalMartes = hoursToString(timeInHours(marSal) - timeInHours(marEnt));
        if (!(totalMartes == 'NaN:NaN')) {
            horasValid = true;
        }
        //Miercoles
        var mieEnt = $('#id_asignaciondet_set-' + i + '-mieEnt').val();
        var mieSal = $('#id_asignaciondet_set-' + i + '-mieSal').val();
        var totalMiercoles = hoursToString(timeInHours(mieSal) - timeInHours(mieEnt));
        if (!(totalMiercoles == 'NaN:NaN')) {
            horasValid = true;
        }
        //Jueves
        var jueEnt = $('#id_asignaciondet_set-' + i + '-jueEnt').val();
        var jueSal = $('#id_asignaciondet_set-' + i + '-jueSal').val();
        var totalJueves = hoursToString(timeInHours(jueSal) - timeInHours(jueEnt));
        if (!(totalJueves == 'NaN:NaN')) {
            horasValid = true;
        }
        //Viernes
        var vieEnt = $('#id_asignaciondet_set-' + i + '-vieEnt').val();
        var vieSal = $('#id_asignaciondet_set-' + i + '-vieSal').val();
        var totalViernes = hoursToString(timeInHours(vieSal) - timeInHours(vieEnt));
        if (!(totalViernes == 'NaN:NaN')) {
            horasValid = true;
        }
        //Sabado
        var sabEnt = $('#id_asignaciondet_set-' + i + '-sabEnt').val();
        var sabSal = $('#id_asignaciondet_set-' + i + '-sabSal').val();
        var totalSabado = hoursToString(timeInHours(sabSal) - timeInHours(sabEnt));
        if (!(totalSabado == 'NaN:NaN')) {
            horasValid = true;
        }
        //Domingo
        var domEnt = $('#id_asignaciondet_set-' + i + '-domEnt').val();
        var domSal = $('#id_asignaciondet_set-' + i + '-domSal').val();
        var totalDomingo = hoursToString(timeInHours(domSal) - timeInHours(domEnt));
        if (!(totalDomingo == 'NaN:NaN')) {
            horasValid = true;
        }
        if (fechasValid && horasValid && hasPerfil) {
            var operario = $('#id_asignaciondet_set-' + i + '-operario').val();
            if (operario == "") {
                $('#filter_operario-' + id).prop("disabled", false);
            }
            else {
                $('#filter_operario-' + id).prop("disabled", true);
            }
        } else {
            $('#filter_operario-' + id).prop("disabled", true);
        }

    }
    function RecalcularHorasLunSabADom() {
        var diurnas = "00:00";
        var nocturnas = "00:00";
        var diurnas_dom = "00:00";
        var nocturnas_dom = "00:00";

    }
    function RecalcularHoras() {
        //aqui empieza el calculo del total de horas normales
        var $totalDetalle = $('#id_asignaciondet_set-TOTAL_FORMS');
        var totalDet = parseInt($totalDetalle.val(), 10);
        for (i = 0; i < totalDet; i++) {
            var total_horas_detalle = '00:00';
            if (!($('#leaveForm-' + i).css('display') == 'none')) {
                habilitarBusqueda(i);

                //Lunes
                var lunEnt = $('#id_asignaciondet_set-' + i + '-lunEnt').val();
                var lunSal = $('#id_asignaciondet_set-' + i + '-lunSal').val();
                var totalLunes = hoursToString(timeInHours(lunSal) - timeInHours(lunEnt));
                if (!(totalLunes == 'NaN:NaN')) {
                    habilitarBusqueda(i);
                    total_horas_detalle = SumHrMin(total_horas_detalle, totalLunes);
                }

                //Martes
                var marEnt = $('#id_asignaciondet_set-' + i + '-marEnt').val();
                var marSal = $('#id_asignaciondet_set-' + i + '-marSal').val();
                var totalMartes = hoursToString(timeInHours(marSal) - timeInHours(marEnt));
                if (!(totalMartes == 'NaN:NaN')) {
                    habilitarBusqueda(i);
                    total_horas_detalle = SumHrMin(total_horas_detalle, totalMartes);
                }
                //Miercoles
                var mieEnt = $('#id_asignaciondet_set-' + i + '-mieEnt').val();
                var mieSal = $('#id_asignaciondet_set-' + i + '-mieSal').val();
                var totalMiercoles = hoursToString(timeInHours(mieSal) - timeInHours(mieEnt));
                if (!(totalMiercoles == 'NaN:NaN')) {
                    habilitarBusqueda(i);
                    total_horas_detalle = SumHrMin(total_horas_detalle, totalMiercoles);
                }
                //Jueves
                var jueEnt = $('#id_asignaciondet_set-' + i + '-jueEnt').val();
                var jueSal = $('#id_asignaciondet_set-' + i + '-jueSal').val();
                var totalJueves = hoursToString(timeInHours(jueSal) - timeInHours(jueEnt));
                if (!(totalJueves == 'NaN:NaN')) {
                    habilitarBusqueda(i);
                    total_horas_detalle = SumHrMin(total_horas_detalle, totalJueves);
                }
                //Viernes
                var vieEnt = $('#id_asignaciondet_set-' + i + '-vieEnt').val();
                var vieSal = $('#id_asignaciondet_set-' + i + '-vieSal').val();
                var totalViernes = hoursToString(timeInHours(vieSal) - timeInHours(vieEnt));
                if (!(totalViernes == 'NaN:NaN')) {
                    habilitarBusqueda(i);
                    total_horas_detalle = SumHrMin(total_horas_detalle, totalViernes);
                }
                //Sabado
                var sabEnt = $('#id_asignaciondet_set-' + i + '-sabEnt').val();
                var sabSal = $('#id_asignaciondet_set-' + i + '-sabSal').val();
                var totalSabado = hoursToString(timeInHours(sabSal) - timeInHours(sabEnt));
                if (!(totalSabado == 'NaN:NaN')) {
                    habilitarBusqueda(i);
                    total_horas_detalle = SumHrMin(total_horas_detalle, totalSabado);
                }
                //Domingo
                var domEnt = $('#id_asignaciondet_set-' + i + '-domEnt').val();
                var domSal = $('#id_asignaciondet_set-' + i + '-domSal').val();
                var totalDomingo = hoursToString(timeInHours(domSal) - timeInHours(domEnt));
                if (!(totalDomingo == 'NaN:NaN')) {
                    habilitarBusqueda(i);
                    total_horas_detalle = SumHrMin(total_horas_detalle, totalDomingo);
                }
            }
            $('#id_asignaciondet_set-' + i + '-totalHoras').val(total_horas_detalle.split(':')[0]);
        }

        $('#id_totalasignado').val(total_horas_detalle);
        $('#sumAll_resto').val(hoursToString(timeInHours($('#sumAll_total').val()) - timeInHours(total_horas_detalle)));

    }


    function RecalcularHorasV2() {
        //aqui empieza el calculo del total de horas normales

        var totalDet = $(".row-table").length;
        var subTotal = '00:00';

        subTotal = SumHrMin($("#id_totalasignado").val(), subTotal);
        //$('#id_asignaciondet_set-' + i + '-totalHoras').val(total_horas_detalle.split(':')[0]);
        // var total_sem_diurnas = undefined;
        // temp = hoursToString((parseFloat($('#tot_sem_diu').val()) - timeInHours(total_sem_diurnas != undefined ? total_sem_diurnas : '00:00')));
        // console.log("TEMMMP",temp)
        // if (temp.substring(0, 1) == '-') {
        //     document.getElementById("res_sem_diu").style.color = "#ff0000";
        // } else {
        //     document.getElementById("res_sem_diu").style.color = "#000000";
        // }

        // var total_sem_nocturnas = undefined;
        // temp = hoursToString((parseFloat($('#tot_sem_noc').val()) - timeInHours(total_sem_nocturnas != undefined ? total_sem_nocturnas : '00:00')));
        // if (temp.substring(0, 1) == '-') {
        //     document.getElementById("res_sem_noc").style.color = "#ff0000";
        // } else {
        //     document.getElementById("res_sem_noc").style.color = "#000000";
        // }

        // var total_dom_diurnas = undefined;
        // temp = hoursToString((parseFloat($('#tot_dom_diu').val()) - timeInHours(total_dom_diurnas != undefined ? total_dom_diurnas : '00:00')));
        // if (temp.substring(0, 1) == '-') {
        //     document.getElementById("res_dom_diu").style.color = "#ff0000";
        // } else {
        //     document.getElementById("res_dom_diu").style.color = "#000000";
        // }

        // var total_dom_nocturnas = undefined;
        // temp = hoursToString((parseFloat($('#tot_dom_noc').val()) - timeInHours(total_dom_nocturnas != undefined ? total_dom_nocturnas : '00:00')));
        // if (temp.substring(0, 1) == '-') {
        //     document.getElementById("res_dom_noc").style.color = "#ff0000";
        // } else {
        //     document.getElementById("res_dom_noc").style.color = "#000000";
        // }

        // $('#id_totalasignado').val(subTotal);
        // temp = hoursToString(timeInHours($('#sumAll_total').val()) - timeInHours(subTotal));
        // if (temp.substring(0, 1) == '-') {
        //     document.getElementById("sumAll_resto").style.color = "#ff0000";
        // } else {
        //     document.getElementById("sumAll_resto").style.color = "#000000";
        // }
        $('#sumAll_resto').val(hoursToString(timeInHours($('#sumAll_total').val()) - timeInHours(subTotal)));
        //if($('#sumAll_resto').val()>=0){$('#sumAll_resto').removeClass("text-danger");}else{$('#sumAll_resto').addClass("text-danger");}

        $('#res_sem_diu').val(hoursToString(timeInHours($('#tot_sem_diu').val() != undefined && $('#tot_sem_diu').val() != "" && isNaN($('#tot_sem_diu').val()) ? $('#tot_sem_diu').val() : "00:00") - timeInHours($('#sum_sem_diu').val() != undefined && $('#sum_sem_diu').val() != "" ? $('#sum_sem_diu').val() : "00:00")));
        //if(timeInHours($('#tot_sem_diu').val()!=undefined&&$('#tot_sem_diu').val()!=""?$('#tot_sem_diu').val():"00:00") - timeInHours($('#sum_sem_diu').val()!=undefined&&$('#sum_sem_diu').val()!=""?$('#sum_sem_diu').val():"00:00")>=0){$('#res_sem_diu').removeClass("text-danger");}else{$('#res_sem_diu').addClass("text-danger");}
        $('#res_sem_noc').val(hoursToString(timeInHours($('#tot_sem_noc').val() != undefined && $('#tot_sem_noc').val() != "" && isNaN($('#tot_sem_noc').val()) ? $('#tot_sem_noc').val() : "00:00") - timeInHours($('#sum_sem_noc').val() != undefined && $('#sum_sem_noc').val() != "" ? $('#sum_sem_noc').val() : "00:00")));
        //if(timeInHours($('#tot_sem_noc').val()!=undefined&&$('#tot_sem_noc').val()!=""?$('#tot_sem_noc').val():"00:00") - timeInHours($('#sum_sem_noc').val()!=undefined&&$('#sum_sem_noc').val()!=""?$('#sum_sem_noc').val():"00:00")>=0){$('#res_sem_noc').removeClass("text-danger");}else{$('#res_sem_noc').addClass("text-danger");}
        $('#res_dom_diu').val(hoursToString(timeInHours($('#tot_dom_diu').val() != undefined && $('#tot_dom_diu').val() != "" && isNaN($('#tot_dom_diu').val()) ? $('#tot_dom_diu').val() : "00:00") - timeInHours($('#sum_dom_diu').val() != undefined && $('#sum_dom_diu').val() != "" ? $('#sum_dom_diu').val() : "00:00")));
        //if(timeInHours($('#tot_dom_diu').val()!=undefined&&$('#tot_dom_diu').val()!=""?$('#tot_dom_diu').val():"00:00") - timeInHours($('#sum_dom_diu').val()!=undefined&&$('#sum_dom_diu').val()!=""?$('#sum_dom_diu').val():"00:00")>=0){$('#res_dom_diu').removeClass("text-danger");}else{$('#res_dom_diu').addClass("text-danger");}
        $('#res_dom_noc').val(hoursToString(timeInHours($('#tot_dom_noc').val() != undefined && $('#tot_dom_noc').val() != "" && isNaN($('#tot_dom_noc').val()) ? $('#tot_dom_noc').val() : "00:00") - timeInHours($('#sum_dom_noc').val() != undefined && $('#sum_dom_noc').val() != "" ? $('#sum_dom_noc').val() : "00:00")));
        //if(timeInHours($('#tot_dom_noc').val()!=undefined&&$('#tot_dom_noc').val()!=""?$('#tot_dom_noc').val():"00:00") - timeInHours($('#sum_dom_noc').val()!=undefined&&$('#sum_dom_noc').val()!=""?$('#sum_dom_noc').val():"00:00")>=0){$('#res_dom_noc').removeClass("text-danger");}else{$('#res_dom_noc').addClass("text-danger");}

    }




    function RecalcularTipoHoras() {
        //aqui empieza el calculo de los distintos tipos de horas
        var total_horas_detalle = '00:00';
        var total_sem_nocturnas = '00:00';
        var total_sem_diurnas = '00:00';
        var total_dom_nocturnas = '00:00';
        var total_dom_diurnas = '00:00';
        var totalHorasSemanales = '00:00';
        var totalDet = $('.row-table').length;
        var lunes = $(".lunes");
        var martes = $(".martes");
        var miercoles = $(".miercoles");
        var jueves = $(".jueves");
        var viernes = $(".viernes");
        var sabado = $(".sabado");
        var domingo = $(".domingo");
        console.log("TOTAL DETALLES",totalDet)
        for (i = 0; i < totalDet; i++) {
            totalHorasSemanales = '00:00';
            //Lunes
            if (lunes.length > 0) {
                var horarioLunes = (lunes[i].innerText).split(" a ");
                var lunEnt = String(horarioLunes[0]);
                var lunSal = String(horarioLunes[1]);
                temp = obtenerNocturnas(lunEnt, lunSal);
                totalLunes = parseFloat(timeInHours(lunSal)).toFixed(2) - parseFloat(timeInHours(lunEnt)).toFixed(2);
                if (!(totalLunes == 'NaN:NaN') && !isNaN(totalLunes)) {
                    totalHorasSemanales = SumHrMin(totalHorasSemanales,hoursToString(totalLunes))
                    total_sem_diurnas = SumHrMin(total_sem_diurnas, hoursToString(totalLunes - timeInHours(temp)));
                    total_sem_nocturnas = SumHrMin(total_sem_nocturnas, temp);
                }
            }


            //Martes
            if (martes.length > 0) {
                var horarioMartes = (martes[i].innerText).split(" a ");
                var marEnt = String(horarioMartes[0]);
                var marSal = String(horarioMartes[1]);
                temp = obtenerNocturnas(marEnt, marSal);
                var totalMartes = timeInHours(marSal) - timeInHours(marEnt);
                if (!(totalMartes == 'NaN:NaN') && !isNaN(totalMartes)) {
                    totalHorasSemanales = SumHrMin(totalHorasSemanales,hoursToString(totalMartes))
                    total_sem_diurnas = SumHrMin(total_sem_diurnas, hoursToString(totalMartes - timeInHours(temp)));
                    total_sem_nocturnas = SumHrMin(total_sem_nocturnas, temp);
                }
            }

            if (miercoles.length > 0) {
                //Miercoles
                var horarioMiercoles = (miercoles[i].innerText).split(" a ");
                var mieEnt = String(horarioMiercoles[0]);
                var mieSal = String(horarioMiercoles[1]);
                temp = obtenerNocturnas(mieEnt, mieSal);
                var totalMiercoles = timeInHours(mieSal) - timeInHours(mieEnt);
                if (!(totalMiercoles == 'NaN:NaN') && !isNaN(totalMiercoles)) {
                    totalHorasSemanales = SumHrMin(totalHorasSemanales,hoursToString(totalMiercoles))
                    total_sem_diurnas = SumHrMin(total_sem_diurnas, hoursToString(totalMiercoles - timeInHours(temp)));
                    total_sem_nocturnas = SumHrMin(total_sem_nocturnas, temp);
                }
            }
            if (jueves.length > 0) {
                //Jueves
                var horarioJueves = (jueves[i].innerText).split(" a ");
                var jueEnt = String(horarioJueves[0]);
                var jueSal = String(horarioJueves[1]);
                temp = obtenerNocturnas(jueEnt, jueSal);
                var totalJueves = timeInHours(jueSal) - timeInHours(jueEnt);
                if (!(totalJueves == 'NaN:NaN') && !isNaN(totalJueves)) {
                    totalHorasSemanales = SumHrMin(totalHorasSemanales,hoursToString(totalJueves))
                    total_sem_diurnas = SumHrMin(total_sem_diurnas, hoursToString(totalJueves - timeInHours(temp)));
                    total_sem_nocturnas = SumHrMin(total_sem_nocturnas, temp);
                }
            }
            if (viernes.length > 0) {
                //Viernes
                var horarioViernes = (viernes[i].innerText).split(" a ");
                var vieEnt = String(horarioViernes[0]);
                var vieSal = String(horarioViernes[1]);
                temp = obtenerNocturnas(vieEnt, vieSal);
                var totalViernes = timeInHours(vieSal) - timeInHours(vieEnt);
                if (!(totalViernes == 'NaN:NaN') && !isNaN(totalViernes)) {
                    totalHorasSemanales = SumHrMin(totalHorasSemanales,hoursToString(totalViernes))
                    total_sem_diurnas = SumHrMin(total_sem_diurnas, hoursToString(totalViernes - timeInHours(temp)));
                    total_sem_nocturnas = SumHrMin(total_sem_nocturnas, temp);
                }
            }
            if (sabado.length > 0) {
                //Sabado
                var horarioSabado = (sabado[i].innerText).split(" a ");
                var sabEnt = String(horarioSabado[0]);
                var sabSal = String(horarioSabado[1]);
                temp = obtenerNocturnas(sabEnt, sabSal);
                var totalSabado = timeInHours(sabSal) - timeInHours(sabEnt);
                if (!(totalSabado == 'NaN:NaN') && !isNaN(totalSabado)) {
                    totalHorasSemanales = SumHrMin(totalHorasSemanales,hoursToString(totalSabado))
                    total_sem_diurnas = SumHrMin(total_sem_diurnas, hoursToString(totalSabado - timeInHours(temp)));
                    total_sem_nocturnas = SumHrMin(total_sem_nocturnas, temp);
                }
            }
            if (domingo.length > 0) {
                //Domingo
                var horarioDomingo = (sabado[i].innerText).split(" a ");
                var domEnt = String(horarioDomingo[0]);
                var domSal = String(horarioDomingo[1]);
                temp = obtenerNocturnas(domEnt, domSal);
                var totalDomingo = timeInHours(domSal) - timeInHours(domEnt);
                if (!(totalDomingo == 'NaN:NaN') && !isNaN(totalDomingo)) {
                    totalHorasSemanales = SumHrMin(totalHorasSemanales,hoursToString(totalDomingo))
                    total_dom_diurnas = SumHrMin(total_dom_diurnas, hoursToString(totalDomingo - timeInHours(temp)));
                    total_dom_nocturnas = SumHrMin(total_dom_nocturnas, temp);
                }
            }
            $('#cantTotal-'+(i+1)).text(totalHorasSemanales);
        }
        var total_semanales = SumHrMin(total_sem_diurnas,total_sem_nocturnas);
        var total_domingos = SumHrMin(total_dom_diurnas,total_dom_nocturnas);
        console.log(total_semanales,total_domingos)
        $('#id_totalasignado').val(SumHrMin(total_semanales,total_domingos))
        $('#sumAll_resto').val(hoursToString(timeInHours($('#sumAll_total').val()) - timeInHours($('#id_totalasignado').val())));
        $('#sum_sem_diu').val(total_sem_diurnas);
        $('#sum_sem_noc').val(total_sem_nocturnas);
        $('#sum_dom_diu').val(total_dom_diurnas);
        $('#sum_dom_noc').val(total_dom_nocturnas);

        //total_sem_diurnas
        temp = hoursToString((parseFloat($('#tot_sem_diu').val()) - timeInHours(total_sem_diurnas)));
        if (temp.substring(0, 1) == '-') {
            document.getElementById("res_sem_diu").style.color = "#ff0000";
        } else {
            document.getElementById("res_sem_diu").style.color = "#000000";
        }

        //total_sem_nocturnas
        temp = hoursToString((parseFloat($('#tot_sem_noc').val()) - timeInHours(total_sem_nocturnas)));
        if (temp.substring(0, 1) == '-') {
            document.getElementById("res_sem_noc").style.color = "#ff0000";
        } else {
            document.getElementById("res_sem_noc").style.color = "#000000";
        }

        //total_dom_diurnas
        temp = hoursToString((parseFloat($('#tot_dom_diu').val()) - timeInHours(total_dom_diurnas)));
        if (temp.substring(0, 1) == '-') {
            document.getElementById("res_dom_diu").style.color = "#ff0000";
        } else {
            document.getElementById("res_dom_diu").style.color = "#000000";
        }

        //total_dom_nocturnas
        temp = hoursToString((parseFloat($('#tot_dom_noc').val()) - timeInHours(total_dom_nocturnas)));
        if (temp.substring(0, 1) == '-') {
            document.getElementById("res_dom_noc").style.color = "#ff0000";
        } else {
            document.getElementById("res_dom_noc").style.color = "#000000";
        }
        temp = hoursToString(timeInHours($('#sumAll_total').val()));
        if (temp.substring(0, 1) == '-') {
            document.getElementById("sumAll_resto").style.color = "#ff0000";
        } else {
            document.getElementById("sumAll_resto").style.color = "#000000";
        }
        $('#res_sem_diu').val(hoursToString((parseFloat($('#tot_sem_diu').val()) - timeInHours(total_sem_diurnas))));
        $('#res_sem_noc').val(hoursToString((parseFloat($('#tot_sem_noc').val()) - timeInHours(total_sem_nocturnas))));
        $('#res_dom_diu').val((hoursToString((parseFloat($('#tot_dom_diu').val()) - timeInHours(total_dom_diurnas)))));
        $('#res_dom_noc').val(hoursToString((parseFloat($('#tot_dom_noc').val()) - timeInHours(total_dom_nocturnas))));
    }

    $(function () {

        // Reemplaza todas las coincidencias en vez de solo la primera
        function replaceAll(text, busca, reemplaza) {
            while (text.toString().indexOf(busca) != -1)
                text = text.toString().replace(busca, reemplaza);
            return text;
        }

        var $totalDetalle = $('#id_asignaciondet_set-TOTAL_FORMS');

        $('#btnDet').click(function (event) {

            event.preventDefault();
            var total = parseInt($totalDetalle.val(), 10);
            var clon = $('script[type="template/Detalle"]').html();
            clon_html = replaceAll(clon, '__prefix__', (total).toString());
            clon_html1 = replaceAll(clon_html, 'id="leaveForm"', 'id="leaveForm-' + (total).toString() + '"');
            clon_html2 = replaceAll(clon_html1, 'id="filter_operario-"', 'id="filter_operario-' + (total).toString() + '"');
            clon_html3 = replaceAll(clon_html2, 'id="modalFiltro"', 'id="modalFiltro' + (total).toString() + '"');
            clon_html4 = replaceAll(clon_html3, 'id="jsGrid"', 'id="jsGrid' + (total).toString() + '"');
            clon_html5 = replaceAll(clon_html4, 'id="operario-"', 'id="operario-' + (total).toString() + '"');
            clon_html6 = replaceAll(clon_html5, 'name="operario-"', 'name="operario-' + (total).toString() + '"');
            clon_html7 = replaceAll(clon_html6, 'name="horaInicio-"', 'name="horaInicio-' + (total).toString() + '"');
            clon_html8 = replaceAll(clon_html7, 'id="id_horaInicio-"', 'id="id_horaInicio-' + (total).toString() + '"');
            clon_html9 = replaceAll(clon_html8, 'name="horaFin-"', 'name="horaFin-' + (total).toString() + '"');
            clon_html10 = replaceAll(clon_html9, 'id="id_horaFin-"', 'id="id_horaFin-' + (total).toString() + '"');
            clon_html11 = replaceAll(clon_html10, 'name="diaInicio-"', 'name="diaInicio-' + (total).toString() + '"');
            clon_html12 = replaceAll(clon_html11, 'id="id_diaInicio-"', 'id="id_diaInicio-' + (total).toString() + '"');
            clon_html13 = replaceAll(clon_html12, 'name="diaFin-"', 'name="diaFin-' + (total).toString() + '"');
            clon_html14 = replaceAll(clon_html13, 'id="id_diaFin-"', 'id="id_diaFin-' + (total).toString() + '"');
            clon_html15 = replaceAll(clon_html14, 'id="perfil-"', 'id="perfil-' + (total).toString() + '"');
            clon_html16 = replaceAll(clon_html15, 'onclick="deleteLeaveRow(this,);"', 'onclick="deleteLeaveRow(this,' + (total).toString() + ');"');
            $('#formset-det').append(clon_html16);
            $('#id_asignaciondet_set-' + (total) + '-DELETE').attr('style', 'display:none !important')
            $("#id_asignaciondet_set-" + (total) + "-DELETE").prop("checked", false);
            $('#guardar').prop("disabled", true);


            $totalDetalle.val(total + 1);
            var body = {
                "id_puntoServicio": $('#id_puntoServicio').val(),
                csrfmiddlewaretoken: '{{csrf_token}}'
            }
            $.ajax({
                type: "POST",
                url: "/reingenieria/asignacion/agregarDetalle",
                data: body
            }).done(function (result) {
                if (result.codigo == 0) {
                    $('html, body').animate({ scrollTop: document.body.scrollHeight }, 'low');
                }
            });
        });

    });

</script>
<script>
    $(document).on('focus', '.examDate', function () {
        $(this).datetimepicker({
            locale: 'es',
            format: 'DD/MM/YYYY'
        })
    })
</script>
<script>
    $(document).on('focus', '.examTime', function () {
        $(this).datetimepicker({
            format: 'HH:mm'
        })
    })
</script>
<style>
    .btn-info.disabled,
    .btn-info:disabled {
        background-color: #7b9da2 !important;
        border-color: #6e7b7d !important;
    }

    .modal-dialog {
        max-width: 1050px !important;
        width: 1105px !important;
    }

    table th p {
        margin: 10px 0px !important;
    }

    .jsgrid-grid-body {
        height: 275px !important;
    }

    table tr {
        cursor: pointer !important;
    }

    .jsgrid-nodata-row {
        height: 273px !important;
    }

    .head {
        background-color: #86273e !important;
        color: white !important;
    }

    .select-form {
        height: 40px !important;
    }

    .data:hover {
        background-color: #86273e1f !important;
    }

    .card-header {
        background-color: #86273e !important;
        color: white !important;
        font-size: 20px !important;
        border-radius: 0px !important;
        border-bottom: 1px solid gray !important;
        padding: .35rem 1.25rem !important;
    }

    .card {
        border-radius: 0px !important;
        border: none !important;
    }

    .card-body {
        padding: 0px !important;
    }

    .table th {
        padding: 0.2rem .75rem !important;
        background-color: white !important;
    }

    .header-table th {
        padding: 10px !important;
        background-color: #636363 !important;
        color: white !important;
    }

    .action-table {
        color: #636363 !important;
    }

    .action-table:hover {
        text-decoration: none !important;
    }

    .table-bordered th {
        border: 0px solid #e9ecef !important;
    }

    .table-bordered {
        border: none !important;
    }

    .table-bordered td {
        border: none !important;
    }
</style>

{% endblock %}